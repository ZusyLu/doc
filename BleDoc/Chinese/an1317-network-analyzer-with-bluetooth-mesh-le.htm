<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>AN1317: Using Network Analyzer with Bluetooth Mesh Applications</title><meta name="author" content="Silicon Labs"/><style type="text/css"> * {margin:0; padding:0; text-indent:0; }
 .h1, h1 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 24pt; }
 .s1 { color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: bold; text-decoration: none; font-size: 24pt; }
 .s2 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6pt; }
 .s3 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s4 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .p, p { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; margin:0pt; }
 .s6 { color: #00F; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 9pt; }
 .a, a { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s7 { color: #007693; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 h4 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; }
 .s8 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 .s9 { color: black; font-family:"Courier New", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s10 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s11 { color: #049; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s12 { color: #049; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s13 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s14 { color: black; font-family:Symbol, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s15 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 .s16 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s18 { color: #00F; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s19 { color: #00F; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s20 { color: black; font-family:"Courier New", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 h2 { color: #FFF; font-family:"Lucida Sans", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 20pt; }
 .s21 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s22 { color: #4C4D4F; font-family:"Lucida Sans", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .s23 { color: #424242; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s24 { color: #424242; font-family:"Lucida Sans", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7pt; }
 .s25 { color: #4C4D4F; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s26 { color: #4C4D4F; font-family:"Arial Black", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s28 { color: #4C4D4F; font-family:"Lucida Sans", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7pt; }
 .s30 { color: #0086DD; font-family:"Lucida Sans", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7pt; }
 .s31 { color: #4C4D4F; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4pt; vertical-align: 2pt; }
 h3 { color: #FB1725; font-family:"Lucida Sans", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 14pt; }
 li {display: block; }
 #l1 {padding-left: 0pt; }
 #l1> li>*:first-child:before {content: " "; color: black; font-family:Symbol, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 li {display: block; }
 #l2 {padding-left: 0pt;counter-reset: d1 1; }
 #l2> li>*:first-child:before {counter-increment: d1; content: counter(d1, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l2> li:first-child>*:first-child:before {counter-increment: d1 0;  }
 #l3 {padding-left: 0pt;counter-reset: d2 1; }
 #l3> li>*:first-child:before {counter-increment: d2; content: counter(d1, decimal)"."counter(d2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l3> li:first-child>*:first-child:before {counter-increment: d2 0;  }
 #l4 {padding-left: 0pt;counter-reset: d2 1; }
 #l4> li>*:first-child:before {counter-increment: d2; content: counter(d1, decimal)"."counter(d2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l4> li:first-child>*:first-child:before {counter-increment: d2 0;  }
 #l5 {padding-left: 0pt;counter-reset: d2 1; }
 #l5> li>*:first-child:before {counter-increment: d2; content: counter(d1, decimal)"."counter(d2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l5> li:first-child>*:first-child:before {counter-increment: d2 0;  }
 #l6 {padding-left: 0pt;counter-reset: d3 1; }
 #l6> li>*:first-child:before {counter-increment: d3; content: counter(d1, decimal)"."counter(d2, decimal)"."counter(d3, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l6> li:first-child>*:first-child:before {counter-increment: d3 0;  }
 #l7 {padding-left: 0pt;counter-reset: d3 1; }
 #l7> li>*:first-child:before {counter-increment: d3; content: counter(d1, decimal)"."counter(d2, decimal)"."counter(d3, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l7> li:first-child>*:first-child:before {counter-increment: d3 0;  }
 #l8 {padding-left: 0pt;counter-reset: d2 1; }
 #l8> li>*:first-child:before {counter-increment: d2; content: counter(d1, decimal)"."counter(d2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l8> li:first-child>*:first-child:before {counter-increment: d2 0;  }
 #l9 {padding-left: 0pt;counter-reset: d3 1; }
 #l9> li>*:first-child:before {counter-increment: d3; content: counter(d1, decimal)"."counter(d2, decimal)"."counter(d3, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l9> li:first-child>*:first-child:before {counter-increment: d3 0;  }
 #l10 {padding-left: 0pt;counter-reset: d3 1; }
 #l10> li>*:first-child:before {counter-increment: d3; content: counter(d1, decimal)"."counter(d2, decimal)"."counter(d3, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l10> li:first-child>*:first-child:before {counter-increment: d3 0;  }
 li {display: block; }
 #l11 {padding-left: 0pt;counter-reset: e1 1; }
 #l11> li>*:first-child:before {counter-increment: e1; content: counter(e1, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; }
 #l11> li:first-child>*:first-child:before {counter-increment: e1 0;  }
 #l12 {padding-left: 0pt;counter-reset: e2 1; }
 #l12> li>*:first-child:before {counter-increment: e2; content: counter(e1, decimal)"."counter(e2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l12> li:first-child>*:first-child:before {counter-increment: e2 0;  }
 #l13 {padding-left: 0pt;counter-reset: e2 1; }
 #l13> li>*:first-child:before {counter-increment: e2; content: counter(e1, decimal)"."counter(e2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l13> li:first-child>*:first-child:before {counter-increment: e2 0;  }
 #l14 {padding-left: 0pt; }
 #l14> li>*:first-child:before {content: " "; color: black; font-family:Symbol, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l15 {padding-left: 0pt;counter-reset: e2 1; }
 #l15> li>*:first-child:before {counter-increment: e2; content: counter(e1, decimal)"."counter(e2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l15> li:first-child>*:first-child:before {counter-increment: e2 0;  }
 #l16 {padding-left: 0pt;counter-reset: e3 1; }
 #l16> li>*:first-child:before {counter-increment: e3; content: counter(e1, decimal)"."counter(e2, decimal)"."counter(e3, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l16> li:first-child>*:first-child:before {counter-increment: e3 0;  }
 #l17 {padding-left: 0pt;counter-reset: g1 1; }
 #l17> li>*:first-child:before {counter-increment: g1; content: counter(g1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l17> li:first-child>*:first-child:before {counter-increment: g1 0;  }
 #l18 {padding-left: 0pt;counter-reset: h1 1; }
 #l18> li>*:first-child:before {counter-increment: h1; content: counter(h1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l18> li:first-child>*:first-child:before {counter-increment: h1 0;  }
 #l19 {padding-left: 0pt;counter-reset: h2 1; }
 #l19> li>*:first-child:before {counter-increment: h2; content: counter(h2, lower-latin)") "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l19> li:first-child>*:first-child:before {counter-increment: h2 0;  }
 #l20 {padding-left: 0pt;counter-reset: i1 1; }
 #l20> li>*:first-child:before {counter-increment: i1; content: counter(i1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l20> li:first-child>*:first-child:before {counter-increment: i1 0;  }
 #l21 {padding-left: 0pt;counter-reset: e3 1; }
 #l21> li>*:first-child:before {counter-increment: e3; content: counter(e1, decimal)"."counter(e2, decimal)"."counter(e3, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l21> li:first-child>*:first-child:before {counter-increment: e3 0;  }
 #l22 {padding-left: 0pt; }
 #l22> li>*:first-child:before {content: " "; color: black; font-family:Symbol, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l23 {padding-left: 0pt;counter-reset: e2 1; }
 #l23> li>*:first-child:before {counter-increment: e2; content: counter(e1, decimal)"."counter(e2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l23> li:first-child>*:first-child:before {counter-increment: e2 0;  }
 #l24 {padding-left: 0pt;counter-reset: e3 1; }
 #l24> li>*:first-child:before {counter-increment: e3; content: counter(e1, decimal)"."counter(e2, decimal)"."counter(e3, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l24> li:first-child>*:first-child:before {counter-increment: e3 0;  }
 #l25 {padding-left: 0pt; }
 #l25> li>*:first-child:before {content: " "; color: black; font-family:Symbol, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l26 {padding-left: 0pt;counter-reset: e3 1; }
 #l26> li>*:first-child:before {counter-increment: e3; content: counter(e1, decimal)"."counter(e2, decimal)"."counter(e3, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l26> li:first-child>*:first-child:before {counter-increment: e3 0;  }
 #l27 {padding-left: 0pt;counter-reset: j1 1; }
 #l27> li>*:first-child:before {counter-increment: j1; content: counter(j1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l27> li:first-child>*:first-child:before {counter-increment: j1 0;  }
 #l28 {padding-left: 0pt;counter-reset: k1 1; }
 #l28> li>*:first-child:before {counter-increment: k1; content: counter(k1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l28> li:first-child>*:first-child:before {counter-increment: k1 0;  }
 #l29 {padding-left: 0pt;counter-reset: e3 3; }
 #l29> li>*:first-child:before {counter-increment: e3; content: counter(e1, decimal)"."counter(e2, decimal)"."counter(e3, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l29> li:first-child>*:first-child:before {counter-increment: e3 0;  }
 #l30 {padding-left: 0pt;counter-reset: e3 4; }
 #l30> li>*:first-child:before {counter-increment: e3; content: counter(e1, decimal)"."counter(e2, decimal)"."counter(e3, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l30> li:first-child>*:first-child:before {counter-increment: e3 0;  }
 table, tbody {vertical-align: top; overflow: visible; }
</style></head><body><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="127" height="62" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_001.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-top: 11pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">AN1317: Using Network Analyzer with</h1><p style="text-indent: 0pt;text-align: left;"><span><img width="37" height="37" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_002.png"/></span></p><p class="s1" style="padding-left: 22pt;text-indent: 0pt;text-align: left;">Bluetooth® <span class="h1">Low Energy and Mesh</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="728" height="1" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_003.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="206" height="1" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_004.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s2" style="padding-top: 4pt;padding-bottom: 1pt;padding-left: 13pt;text-indent: 0pt;text-align: left;">KEY POINTS</p><p style="padding-left: 11pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="206" height="1" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_005.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l1"><li><p class="s3" style="padding-left: 20pt;text-indent: -7pt;text-align: left;">Packet Trace Interface</p></li><li><p class="s3" style="padding-top: 3pt;padding-left: 20pt;text-indent: -7pt;text-align: left;">Wireless Network Analysis</p></li><li><p class="s3" style="padding-top: 3pt;padding-left: 20pt;text-indent: -7pt;text-align: left;">ISD capture files</p></li><li><p class="s3" style="padding-top: 3pt;padding-left: 20pt;text-indent: -7pt;text-align: left;">Bluetooth mesh networks</p></li><li><p class="s3" style="padding-top: 3pt;padding-left: 20pt;text-indent: -7pt;text-align: left;">Bluetooth mesh security keys</p></li><li><p class="s3" style="padding-top: 3pt;padding-left: 20pt;text-indent: -7pt;text-align: left;">Bluetooth Low Energy</p></li></ul><p style="text-indent: 0pt;text-align: left;"/><p class="s4" style="padding-top: 4pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">This document briefly describes the features of the Simplicity Studio 5 Network Analyzer for Bluetooth Low Energy and Mesh.</p><p style="padding-top: 9pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">It can be used and read jointly with the <i>AN958: Debugging and Programming Inter- faces for Customer Designs </i>for more information on PTI usage with custom hardware.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;"><a href="https://docs.silabs.com/simplicity-studio-5-users-guide/latest/ss-5-users-guide-tools-network-analyzer/" class="a" target="_blank">This document assumes familiarity with the basic Network Analyzer information in the </a><a href="https://docs.silabs.com/simplicity-studio-5-users-guide/latest/ss-5-users-guide-tools-network-analyzer/" class="s6" target="_blank">Simplicity Studio 5 User’s Guide</a><a href="https://docs.silabs.com/simplicity-studio-5-users-guide/latest/ss-5-users-guide-tools-network-analyzer/" target="_blank">.</a></p><p class="s7" style="padding-bottom: 2pt;text-indent: 0pt;text-align: right;">Table of Contents</p><p style="padding-left: 21pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="724" height="1" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_006.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h4 style="padding-top: 6pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">Table of Contents</h4><ol id="l2"><li><p style="padding-top: 8pt;padding-left: 42pt;text-indent: -19pt;text-align: left;"><a href="#bookmark2" class="a">Introduction </a><a href="#bookmark2">1</a></p><ol id="l3"><li><p style="padding-top: 8pt;padding-left: 63pt;text-indent: -29pt;text-align: left;"><a href="#bookmark3">Debugging a Wireless Network 1</a></p></li></ol></li><li><p style="padding-top: 8pt;padding-left: 42pt;text-indent: -19pt;text-align: left;"><a href="#bookmark7" class="a">Hardware and Packet Trace Interface (PTI) </a><a href="#bookmark7">2</a></p><ol id="l4"><li><p style="padding-top: 8pt;padding-left: 63pt;text-indent: -29pt;text-align: left;"><a href="#bookmark8" class="a">Packet Trace Interface </a><a href="#bookmark8">2</a></p></li><li><p style="padding-top: 8pt;padding-left: 63pt;text-indent: -29pt;text-align: left;"><a href="#bookmark9" class="a">Hardware Kit and PTI </a><a href="#bookmark9">3</a></p></li></ol></li><li><p style="padding-top: 8pt;padding-left: 42pt;text-indent: -19pt;text-align: left;"><a href="#bookmark21" class="a">Network Analyzer Features </a><a href="#bookmark21">5</a></p><ol id="l5"><li><p style="padding-top: 8pt;padding-left: 63pt;text-indent: -29pt;text-align: left;"><a href="#bookmark22" class="a">Tool Access and Preference Page </a><a href="#bookmark22">5</a></p></li><li><p style="padding-top: 8pt;padding-left: 63pt;text-indent: -29pt;text-align: left;"><a href="#bookmark23" class="a">Interface </a><a href="#bookmark23">6</a></p><ol id="l6"><li><p style="padding-top: 8pt;padding-left: 83pt;text-indent: -40pt;text-align: left;"><a href="#bookmark24" class="a">Large File Editor </a><a href="#bookmark24">6</a></p></li><li><p style="padding-top: 8pt;padding-left: 83pt;text-indent: -40pt;text-align: left;"><a href="#bookmark25" class="a">Interval Editor </a><a href="#bookmark25">7</a></p></li></ol></li><li><p style="padding-top: 8pt;padding-left: 63pt;text-indent: -29pt;text-align: left;"><a href="#bookmark26" class="a">ISD File </a><a href="#bookmark26">8</a></p></li><li><p style="padding-top: 8pt;padding-left: 63pt;text-indent: -29pt;text-align: left;"><a href="#bookmark27" class="a">Bookmarks </a><a href="#bookmark27">10</a></p></li><li><p style="padding-top: 8pt;padding-left: 63pt;text-indent: -29pt;text-align: left;"><a href="#bookmark28" class="a">Set Zero-Time Anchor </a><a href="#bookmark28">13</a></p></li><li><p style="padding-top: 8pt;padding-left: 63pt;text-indent: -29pt;text-align: left;"><a href="#bookmark29" class="a">Filters </a><a href="#bookmark29">17</a></p><ol id="l7"><li><p style="padding-top: 8pt;padding-left: 83pt;text-indent: -40pt;text-align: left;"><a href="#bookmark30" class="a">Built-In Filters </a><a href="#bookmark30">17</a></p></li><li><p style="padding-top: 8pt;padding-left: 83pt;text-indent: -40pt;text-align: left;"><a href="#bookmark31" class="a">Manual Filters </a><a href="#bookmark31">17</a></p></li></ol></li></ol></li><li><p style="padding-top: 8pt;padding-left: 42pt;text-indent: -19pt;text-align: left;"><a href="#bookmark41" class="a">Network Analyzer for Bluetooth LE and Mesh </a><a href="#bookmark41">19</a></p><ol id="l8"><li><p style="padding-top: 8pt;padding-left: 63pt;text-indent: -29pt;text-align: left;"><a href="#bookmark42" class="a">Network Analyzer for Bluetooth LE </a><a href="#bookmark42">19</a></p><ol id="l9"><li><p style="padding-top: 8pt;padding-left: 83pt;text-indent: -40pt;text-align: left;"><a href="#bookmark43" class="a">Bluetooth Low Energy Transaction Example </a><a href="#bookmark43">20</a></p></li><li><p style="padding-top: 8pt;padding-left: 83pt;text-indent: -40pt;text-align: left;"><a href="#bookmark44" class="a">Bluetooth Low Energy Data Decryption </a><a href="#bookmark44">22</a></p></li></ol></li><li><p style="padding-top: 8pt;padding-left: 63pt;text-indent: -29pt;text-align: left;"><a href="#bookmark45" class="a">Network Analyzer for Bluetooth Mesh </a><a href="#bookmark45">23</a></p><ol id="l10"><li><p style="padding-top: 8pt;padding-left: 83pt;text-indent: -40pt;text-align: left;"><a href="#bookmark46" class="a">Default IV Index Value </a><a href="#bookmark46">23</a></p></li><li><p style="padding-top: 8pt;padding-left: 83pt;text-indent: -40pt;text-align: left;"><a href="#bookmark47" class="a">Keys </a><a href="#bookmark47">23</a></p></li><li><p style="padding-top: 8pt;padding-left: 83pt;text-indent: -40pt;text-align: left;"><a href="#bookmark48" class="a">Bluetooth Mesh Advertising Packets </a><a href="#bookmark48">26</a></p></li><li><p style="padding-top: 8pt;padding-left: 83pt;text-indent: -40pt;text-align: left;"><a href="#bookmark49" class="a">Proxy Protocol </a><a href="#bookmark49">28</a></p></li></ol></li></ol></li><li><p style="padding-top: 8pt;padding-left: 42pt;text-indent: -19pt;text-align: left;"><a href="#bookmark51" class="a">Bluetooth Mesh Networking and the Network Analyzer </a><a href="#bookmark51">31</a></p></li></ol><p class="s7" style="padding-bottom: 2pt;text-indent: 0pt;text-align: right;">Introduction</p><p style="padding-left: 21pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="724" height="1" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_007.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l11"><li><h4 style="padding-left: 40pt;text-indent: -18pt;text-align: left;"><a name="bookmark0">Introduction</a><a name="bookmark2">&zwnj;</a></h4><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: justify;">Network Analyzer is a tool for analyzing wireless network traffic. It supports a wide variety of short-range wireless protocols like Bluetooth Low Energy, Zigbee, proprietary protocols and others. It is provided as part of the Simplicity Studio tool set.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l12"><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark1">Debugging a Wireless Network</a><a name="bookmark3">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Silicon Labs’ tool set provides the user with a comprehensive way to analyze wireless traffic. With it, the user can tap into the data buffers of the radio transceiver via a dedicated serial hardware interface called the Packet Trace Interface (PTI). PTI data can be then transferred via USB or Ethernet to a computer running Simplicity Studio. Finally, the time-stamped data can be interpreted and displayed in Network Analyzer.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Most Silicon Labs’ development kits, such as the Wireless Starter Kit (WSTK), have the PTI embedded and ready to use. Note that it is also possible to use the network analysis features when working on custom hardware if the PTI pins are exposed via a debug interface.</p></li></ol></li><li><h4 style="padding-top: 7pt;padding-left: 40pt;text-indent: -18pt;text-align: left;"><a name="bookmark4">Hardware and Packet Trace Interface (PTI)</a><a name="bookmark7">&zwnj;</a></h4><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;text-align: justify;">On the EFR32 series 1 and 2, a mechanism is provided for the user to be able to tap into the data buffers at the radio transmitter/receiver level. From the embedded software perspective, this is available through the <b>RAIL Utility, PTI </b>component in Simplicity Studio. That component is effectively a simple packet trace interface driver.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l13"><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark5">Packet Trace Interface</a><a name="bookmark8">&zwnj;</a></p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">The Packet Trace Interface (PTI) is an interface giving serial data access directly to the radio transmitter/receiver frame controller. The following figure describes at a high level the architecture of the radio transceiver.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 80pt;text-indent: 0pt;text-align: left;"><span><img width="569" height="290" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_008.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;text-align: justify;">A clock and data signal are connected to the frame controller to monitor all packets received/transmitted by the chip. At the chip level, a signal is dedicated to trigger the timestamping of each PTI frame by the WSTK board controller. The PTI is a non-intrusive sniffer of data, radio state and time stamp information.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">A single-pin UART signal is used for PTI data transfer. This can be configured in the <b>RAIL Utility, PTI </b>component. The baud rate is selectable. The default baud rate is 1.6 Mbps. The maximum baud rate is 3.2 Mbps.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">When using 2M PHY with Bluetooth Low Energy, the default PTI-over-UART speed (1.6 Mbps) must be increased to a higher baud rate. The following shows an example:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="717" height="171" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_009.jpg"/></span></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;line-height: 107%;text-align: justify;">Additionally, the speed at which the PTI frames are forwarded from the EFR32 back to USB/UART must also be increased. This is done by setting the PTI config corresponding to your adapter at the correct baud rate through the Admin Console interface.</p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">In the Debug Adapters view, right-click the device. In the context menu, select <b>Launch Console…</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 197pt;text-indent: 0pt;text-align: left;"><span><img width="258" height="378" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_010.jpg"/></span></p><p style="padding-top: 6pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Select the Admin tab, and execute the command:</p><p class="s9" style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">pti config 0 efruart 3200000</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="726" height="138" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_011.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark6">Hardware Kit and PTI</a><a name="bookmark9">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">As described previously, the WSTK can be used to monitor the wireless traffic. The WSTK can be connected to the PC via USB or Ethernet:</p><ul id="l14"><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">USB - The simplest solution. This is used throughout this document.</p></li><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Ethernet - Recommended for best performance and scalability.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 185pt;text-indent: 0pt;text-align: left;"><span><img width="292" height="147" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_012.jpg"/></span></p><p class="s8" style="padding-top: 5pt;padding-left: 83pt;text-indent: 0pt;text-align: center;">Figure 2.1. WSTK Board</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;">Alternatively, it is possible to use the PTI on custom hardware if the corresponding pins are exposed (via the 20-pin Simplicity Connector on the WSTK or the Simplicity Mini connector on the debug adapter for example):</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 83pt;text-indent: 0pt;text-align: left;"><span><img width="560" height="283" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_013.jpg"/></span></p><p class="s8" style="padding-top: 4pt;padding-left: 83pt;text-indent: 0pt;text-align: center;">Figure 2.2. Simplicity Debug Adapter Exposing PTI Signals on the Mini and Simplicity Connectors</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 105pt;text-indent: 0pt;text-align: left;"><span><img width="242" height="126" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_014.jpg"/></span>	<span><img width="182" height="134" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_015.jpg"/></span></p><p class="s8" style="padding-top: 8pt;padding-left: 83pt;text-indent: 0pt;text-align: center;">Figure 2.3. 20-Pin Simplicity Connector and the Mini Connector</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;text-align: left;">For more detail, refer to <i>AN958: Debugging and Programming Interfaces</i>.</p></li></ul></li></ol></li><li><h4 style="padding-top: 7pt;padding-left: 40pt;text-indent: -18pt;text-align: left;"><a name="bookmark10">Network Analyzer Features</a><a name="bookmark21">&zwnj;</a></h4><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><a name="bookmark11">This section describes the main features of the Network Analyzer user interface.</a><a name="bookmark22">&zwnj;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l15"><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;">Tool Access and Preference Page</p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">Network Analyzer is provided with Simplicity Studio. For easy access, on the toolbar click <b>Tools</b>, and select <b>Network Analyzer</b>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="716" height="287" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_016.jpg"/></span></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">With Network Analyzer Preferences, accessed by <b>Windows &gt; Preferences </b>or the <b>Preferences </b>control on the toolbar, you can tune the tool, add security keys, and modify displays and icons.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 81pt;text-indent: 0pt;text-align: left;"><span><img width="569" height="355" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_017.jpg"/></span></p><p class="s12" style="padding-top: 5pt;padding-left: 23pt;text-indent: 0pt;text-align: left;"><a href="#bookmark47" class="a">You can also modify the Bluetooth protocol decoder in great detail (under the Decoding menu), define the integration with other tools (Energy profiler, Wireshark), and add Security keys (see section </a><a href="#bookmark47" class="s11">4.2.2 </a>Keys <span style=" color: #000;">for more information).</span></p></li><li><p class="s8" style="padding-top: 7pt;padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark12">Interface</a><a name="bookmark23">&zwnj;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l16"><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark13">Large File Editor</a><a name="bookmark24">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Because radio traffic contained in a captured session can be very large, a pane allowing time interval selection is opened first, as shown in the following figure. The interface implementing that feature is called the Large File Editor. It gives a complete overview of the capture session and allows you to select a specific time interval of study.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="726" height="262" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_018.png"/></span></p><p class="s8" style="padding-top: 6pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Interval viewing pane: <span class="p">Displays the traffic data present in the ISD live or recorded session. The data points corresponding to the green curve represent the number of packets per unit of time. Further display options are available through the right-click context menu.</span></p><p class="s8" style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Open Interval button: <span class="p">Once you have selected the area of interest in the interval view, click </span>Open Interval <a href="#bookmark25" class="a">to see traffic detail. This opens a subsequent window in which transaction and events are listed, as shown in section </a><a href="#bookmark25" class="s11">3.2.2 Interval Editor</a><a href="#bookmark25">.</a></p><p class="s8" style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">List of nodes: <span class="p">In the right pane, the list of nodes present in the selected time interval is shown.</span></p><p class="s8" style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;line-height: 107%;text-align: justify;">Filtering pane: <a href="#bookmark29" class="a">Some packet filtering can be done on the selected time interval. In practice, this is more useful in the transaction/event pane. Filters are explained in more detail in section </a><a href="#bookmark29" class="s11">3.6 Filters</a><a href="#bookmark29">.</a></p><p class="s8" style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Bookmarks and Event Difference pane: <a href="#bookmark27" class="a">Those functions are explained in detail in sections </a><a href="#bookmark27" class="s11">3.4 </a><span class="s12">Bookmarks </span><a href="#bookmark42" class="a">and </a><a href="#bookmark42" class="s11">4.1 Network Analyzer for Bluetooth LE</a><span class="p">, respectively</span></p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">The following figure illustrates a selected interval (using the mouse directly on the waveform). The interval of interest appears in clear, whereas the rest of the interval viewing pane is greyed out.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="718" height="144" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_019.jpg"/></span></p></li><li><p class="s8" style="padding-top: 7pt;padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark14">Interval Editor</a><a name="bookmark25">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">The Editor is laid out as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="722" height="398" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_020.png"/></span></p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">The events displayed in the event pane are directly linked to the transactions displayed in the transaction pane. When a transaction is selected, Network Analyzer jumps to the corresponding events in the event pane.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Press CTRL+SHIFT+Up/Down to toggle between events in a transaction.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">In the <b>Status </b>field, “Missing packets” indicates that a packet expected in the transaction has not been received within the current timeout window.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s8" style="padding-left: 58pt;text-indent: -36pt;text-align: justify;">Note: <span class="p">A transaction is a group of related packets that together form a higher layer protocol procedure or message exchange. In the case of Bluetooth Low Energy (and Bluetooth mesh), a “transaction” refers to an actual Bluetooth Low Energy transaction as defined in the core specification. This corresponds most of the time to a Bluetooth Low Energy procedure. Equally, the event pane displays the actual Bluetooth Low Energy events corresponding to the transaction or procedure. For more details, refer to the Bluetooth Core specification document.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><a href="#bookmark29" class="a">The filtering capabilities of the tool are explained in detail in section </a><a href="#bookmark29" class="s11">3.6 Filters</a><a href="#bookmark29">.</a></p><p class="s8" style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Event detail pane: <span class="p">The event detail pane exhibits all the data present in the corresponding Bluetooth LE packet. The data are displayed in a decoded format allowing the user to unpack the information at all layer levels, from radio information up to the GATT protocol and</span></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Bluetooth mesh Access layer. Using the Option menu in the top right corner of the Event Detail pane, you can expand the bit fields and toggle between hexadecimal and decimal format.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 157pt;text-indent: 0pt;text-align: left;"><span><img width="363" height="328" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_021.gif"/></span></p><p style="padding-top: 6pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Note that when a bit field is selected, the corresponding data is automatically highlighted in the hex dump view of the packet.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Various layers of decoding exist, which can be viewed in the Hex Dump Pane (for Bluetooth mesh, result of Network decryption, Appli- cation decryption, Defragmentation of various levels and so on).</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ol></li><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark15">ISD File</a><a name="bookmark26">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Network Analyzer can capture data from nodes of any connected adapters, either from one node at a time or from multiple nodes. It can display data from Live sessions as well as Recorded sessions.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;line-height: 107%;text-align: left;">Network Analyzer saves session data to an ISD (.isd) file, which is a compressed file that stores session data and the network state. Network state includes display settings such as map modifications, which Network Analyzer restores when you reload the session file.</p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">The following procedure describes how to start a network data capture on a single device:</p><ol id="l17"><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">In <b>Preferences &gt; Simplicity Studio &gt; SDKs </b>select the desired SDK.</p></li><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">In <b>Preferences </b>&gt; <b>Network Analyzer </b>&gt; <b>Decoding </b>&gt;<b>Stack Version, </b>Make sure “Bluetooth Low Energy” is added in the decoding preferences.</p></li><li><p class="s12" style="padding-top: 2pt;padding-left: 37pt;text-indent: -14pt;text-align: left;"><a href="#bookmark47" class="a">If using encryption with known keys, make sure the security keys are added (see section </a><a href="#bookmark47" class="s11">4.2.2 </a>Keys <span style=" color: #000;">for more detail).</span></p></li><li><p style="padding-top: 7pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Connect to the adapter.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 200pt;text-indent: 0pt;text-align: left;"><span><img width="246" height="285" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_022.jpg"/></span></p></li><li><p style="padding-top: 6pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Start capture.</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 198pt;text-indent: 0pt;text-align: left;"><span><img width="254" height="292" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_023.jpg"/></span></p><p style="padding-top: 6pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">To start capturing on several adapters, press and hold the CTRL key and, in the Debug Adapters view:</p><ol id="l18"><li><p style="padding-top: 3pt;padding-left: 40pt;text-indent: -18pt;text-align: left;">Select more than one adapter.</p></li><li><p style="padding-top: 3pt;padding-left: 40pt;text-indent: -18pt;text-align: left;">Right-click and select <b>Connect</b>.</p></li><li><p style="padding-top: 7pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Right-click and select <b>Start Capture.</b></p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Release the CTRL key.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 78pt;text-indent: 0pt;text-align: left;">a) <span><img width="259" height="294" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_024.jpg"/></span><span class="s13">       </span>b) <span><img width="263" height="284" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_025.jpg"/></span></p><ol id="l19"><li><p class="s8" style="padding-top: 5pt;padding-left: 142pt;text-indent: -10pt;text-align: left;">Connect to a Group of Adapters. b) Start Capture on a Group of Adapters</p></li></ol></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: justify;">With Bluetooth mesh, when working in a busy environment, capturing from multiple nodes makes more sense than capturing from only one, because Bluetooth mesh nodes are constantly scanning for incoming packets.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">For example, some nodes might be emitting Bluetooth mesh messages or beacons at the same time the node being used for capturing is answering a configure request. As a result, the data that were sent will not be received, simply because the link layer of the underlying Bluetooth LE stack was in the advertising state and not scanning. Additionally, there are three primary advertising channels and the radio transceiver can only listen to one channel at a time.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">This should not be mistaken for an error or a malfunction in the stack. Rather, this is simply a by-product of the technology reliance on primary advertising channels and advertising PDUs. Apart from the GATT bearer scenario (relying on Bluetooth LE connections), there is no communication collision control.</p><p class="s8" style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">It is possible to use “Duplicate Detection”, i.e. when the same packet is detected on multiple adapters it will only be displayed once. See </span>Preferences-&gt;Network Analyzer-&gt;Capture Configuration <span class="p">for more details.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark16">Bookmarks</a><a name="bookmark27">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Bookmarks can be used for marking events. As the name indicates, those are actual bookmarks that point to a certain Bluetooth LE or mesh event. Those are useful for pinpointing a certain event in a transaction that can be problematic and then sharing it with somebody else.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The following procedure shows how to set and navigate through bookmarks:</p><ol id="l20"><li><p style="padding-top: 7pt;padding-left: 41pt;text-indent: -18pt;text-align: left;">Select the event and right-click it.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 35pt;text-indent: 0pt;text-align: left;"><span><img width="674" height="612" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_026.jpg"/></span></p></li><li><p style="padding-top: 7pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Enter the bookmark name.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;"><span><img width="666" height="601" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_027.jpg"/></span></p></li><li><p style="padding-top: 7pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">See the bookmark recorded (highlighted in yellow).</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 37pt;text-indent: 0pt;text-align: left;"><span><img width="687" height="626" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_028.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark17">Set Zero-Time Anchor</a><a name="bookmark28">&zwnj;</a></p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">When studying a particular event or transaction, it is sometime useful to set it as the time reference. Practically, this means setting the timestamp corresponding to that event or transaction to zero, and then seeing all subsequent timestamps updated according to the new time reference. Using this Network Analyzer feature is also an excellent way to verify the Bluetooth Low Energy advertising or connection timings (advertising interval, connection interval, and so on).</p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">The following describes how this can be done, using a Bluetooth LE Initiating connection (CONNECT_IND) state as an example. Select the particular transaction or event, right-click to open the context menu, and then click <b>Set zero-time event anchor to this event.</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="711" height="637" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_029.jpg"/></span></p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">The timestamps of all events and transactions are then updated, taking into account the new anchor as time reference, as shown in the following figure.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="645" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_030.jpg"/></span></p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">To remove the anchor, right-click the selected event or transaction and click <b>Unset zero-time</b>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="710" height="645" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_031.jpg"/></span></p></li><li><p class="s8" style="padding-top: 7pt;padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark18">Filters</a><a name="bookmark29">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Network Analyzer supports use of a set of built-in and manual filters.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l21"><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark19">Built-In Filters</a><a name="bookmark30">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">The following built-in filters can be enable/disabled when visualizing PTI data:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 215pt;text-indent: 0pt;text-align: left;"><span><img width="207" height="85" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_032.jpg"/></span></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">For example, you can filter Bluetooth LE data out in order to focus on Bluetooth mesh traffic. Radio errors and diagnostics can also be filtered out. Note that radio errors can be useful for debugging.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark20">Manual Filters</a><a name="bookmark31">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">The filter bar is used to filter transactions and events. Each capture session has its own filters settings. When a session’s filter is changed and the filter is applied by clicking <b>Apply </b>in the Filter pane toolbar, Network Analyzer will refresh the display showing only the correspond- ing transactions or events. When you exit Network Analyzer, all sessions filters are cleared and must be reapplied when Network Analyzer is restarted.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Network Analyzer provides two ways to edit filters:</p><ul id="l22"><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Filter Manager: Maintains internally a set of saved filters that you can review and edit. You can also add new filters. You specify any of the saved filters for display on the Filters menu, where they are accessible for use in one or more sessions.</p></li><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Filter Bar: An editor that attaches to a given session, where you can enter one or more filter expressions on the fly. Network Analyzer discards filter bar expressions for all sessions when it exits. It does, however, store the expression for easier future access.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Multiple filters can be combined using logical expressions:</p></li><li><p class="s9" style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">&amp;&amp; <span class="p">- And operator</span></p></li><li><p class="s9" style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">|| <span class="p">– Or operator</span></p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Alternatively, conditions for individual filters can also be used:</p><p class="s14" style="padding-top: 3pt;padding-left: 22pt;text-indent: 0pt;text-align: left;"><span class="s13"> </span><span class="s9">== </span><span class="p">- Equals</span></p></li><li><p class="s9" style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">!= <span class="p">- Not equal</span></p></li><li><p class="s9" style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">|= <span class="p">- Contains</span></p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">The following table shows examples of filtering in Bluetooth mesh traffic:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:23.25pt" cellspacing="0"><tr style="height:15pt"><td style="width:252pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A6A6A6"><p class="s15" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Filter example</p></td><td style="width:267pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A6A6A6"><p class="s15" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Meaning</p></td></tr><tr style="height:13pt"><td style="width:252pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;line-height: 9pt;text-align: left;">transaction.summary |= &quot;BT Mesh&quot;</p></td><td style="width:267pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Show transactions where the <b>summary </b>field contains the text</p></td></tr><tr style="height:12pt"><td style="width:252pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:267pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-left: 5pt;text-indent: 0pt;line-height: 10pt;text-align: left;">”BT Mesh”</p></td></tr><tr style="height:26pt"><td style="width:252pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 3pt;padding-left: 5pt;padding-right: 17pt;text-indent: 0pt;text-align: left;">transaction.summary |= &quot;Generic&quot; &amp;&amp; transaction.dest == &quot;C001&quot;</p></td><td style="width:267pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-left: 5pt;padding-right: 12pt;text-indent: 0pt;text-align: left;">Summary contains string <b>Generic </b>and the destination address is 0xC001</p></td></tr><tr style="height:25pt"><td style="width:252pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">transaction.summary != &quot;EFR Rx packet&quot;</p></td><td style="width:267pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 1pt;padding-left: 5pt;padding-right: 14pt;text-indent: 0pt;text-align: left;">Do not show transactions with summary ”EFR Rx packet” -&gt; Hide those transactions that Network Analyzer cannot decode</p></td></tr></table><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">The following figure shows an example of saved combined filters.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 71pt;text-indent: 0pt;text-align: left;"><span><img width="589" height="153" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_033.jpg"/></span></p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Alternatively, you can right-click and select preset filters.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 48pt;text-indent: 0pt;text-align: left;"><span><img width="651" height="125" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_034.gif"/></span></p></li></ul></li></ol></li></ol></li><li><h4 style="padding-top: 7pt;padding-left: 40pt;text-indent: -18pt;text-align: left;"><a name="bookmark32">Network Analyzer for Bluetooth LE and Mesh</a><a name="bookmark41">&zwnj;</a></h4><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: justify;">This section describes how the Network Analyzer can be used for Bluetooth Low Energy and Bluetooth mesh traffic monitoring. The current version of the Bluetooth core specification supported is 5.2. The current version of Bluetooth mesh profile and model specification is 1.0.1.</p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Bluetooth Low Energy profile support is limited. Additionally, there is no support for Bluetooth LE random addresses resolving.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l23"><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark33">Network Analyzer for Bluetooth LE</a><a name="bookmark42">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">This section reviews the capabilities of Network Analyzer for the Bluetooth LE protocol.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">When Bluetooth Low Energy data is captured, Network Analyzer displays Bluetooth LE transactions and the corresponding events, as shown in the following figure.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="726" height="356" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_035.jpg"/></span></p><p class="s12" style="padding-top: 5pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark25" class="a">It shows that related packets like requests and responses together make a transaction. These transactions are listed separately in the Transactions pane. To find the first packet of the transaction, simply click on the transaction. To see the details of the packet, simply click on the packet. You can see both the raw and the parsed format of the packet in the Hex Dump / Event Detail pane (see section </a><a href="#bookmark25" class="s11">3.2.2 </a>Interval Editor <span style=" color: #000;">for more detail).</span></p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">To disable the display of some transactions that are not of interest, use <b>Preference &gt; Network Analyzer &gt; Decoding &gt; Transaction Grouper</b>.</p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">The following figure shows an example of “BLE Advertisement Grouper”.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;"><span><img width="578" height="412" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_036.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l24"><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark34">Bluetooth Low Energy Transaction Example</a><a name="bookmark43">&zwnj;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 103pt;text-indent: 0pt;text-align: left;"><span><img width="499" height="336" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_037.jpg"/></span></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">The Event Detail pane allows you to inspect packets at various levels, down to radio data. The example above shows a description of a Bluetooth Low Energy connection being established between a central and peripheral.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">When the feature exchange transaction is selected, the Event panes display the corresponding Bluetooth LE events. Scroll up in the Event pane to find the Connection Indication packet.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;text-align: left;"><span><img width="535" height="361" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_038.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;text-align: left;">The packets corresponding only to a particular Bluetooth LE connection can be filtered using the radio synchronization word. To do so, in the Radio info in the Event detail pane, right-click on “Sync word” and add to the filter.</p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Once the Bluetooth LE connection is established, ATT transactions can take place. The following example illustrates a “Read by Group Type” ATT request and the corresponding response. Use the Event Detail pane on the right side to inspect the content of the request..</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 71pt;text-indent: 0pt;text-align: left;"><span><img width="588" height="397" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_039.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;text-align: justify;">After a Bluetooth Low Energy connection is established, the next step is typically the GATT discovery of the GATT Client. A dedicated view is available for that under <b>Preferences &gt; Network Analyzer &gt; Decoding &gt; Bluetooth, </b>which lists all GATT services/characteris- tics/descriptors and handles, can be used. There, the ability to save the view is also provided.</p><p class="s18" style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;"><a href="https://docs.silabs.com/bluetooth/2.13/general/connections/bluetooth-connection-flowcharts" class="a" target="_blank">For more information on how Bluetooth Low Energy operates and how it can be monitored with Network Analyzer, refer to the </a><span style=" color: #00F; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 9pt;">Bluetooth</span><a href="https://docs.silabs.com/bluetooth/2.13/general/connections/bluetooth-connection-flowcharts" class="s19" target="_blank"> </a><a href="https://docs.silabs.com/bluetooth/2.13/general/connections/bluetooth-connection-flowcharts" class="s6" target="_blank">LE connection</a> <a href="https://docs.silabs.com/bluetooth/2.13/general/gatt-protocol/gatt-operation-flowcharts" class="a" target="_blank">and </a><a href="https://docs.silabs.com/bluetooth/2.13/general/gatt-protocol/gatt-operation-flowcharts" class="s6" target="_blank">GATT connection</a> <span style=" color: #000;">flowcharts.</span></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Additionally, the Event Difference pane can be used as a diffing tool between two different events. The following figure illustrates the event diff between a scan request and response.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;"><span><img width="725" height="221" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_040.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark35">Bluetooth Low Energy Data Decryption</a><a name="bookmark44">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Network Analyzer decrypts Legacy encryption automatically. In effect, the keys are harvested from the Bluetooth LE traffic data. When packets are encrypted using Secure Connection on the other hand, they can only be decrypted when using the security manager of the</p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Bluetooth Low Energy stack in debug mode. In the Silicon Labs Bluetooth Low Energy stack, this can be turned on using the following routine:</p><p class="s20" style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">sl_status_t sl_bt_sm_set_debug_mode(void)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;text-align: left;">When using Secure Connections, this has the effect of having the Security Manager using debug keys. Those keys are also known by the Network Analyzer, which allows it to decrypt the Bluetooth LE data traffic.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;"><a href="https://docs.silabs.com/bluetooth/latest/group-sl-bt-sm#ga3e1f66e53987c78c7c8db7c2ce4aab36" class="a" target="_blank">To disable debug mode, restart the device. For more information, please refer to </a><a href="https://docs.silabs.com/bluetooth/latest/group-sl-bt-sm#ga3e1f66e53987c78c7c8db7c2ce4aab36" class="s6" target="_blank">docs.silabs.com</a><a href="https://docs.silabs.com/bluetooth/latest/group-sl-bt-sm#ga3e1f66e53987c78c7c8db7c2ce4aab36" target="_blank">.</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ol></li><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark36">Network Analyzer for Bluetooth Mesh</a><a name="bookmark45">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">This section presents the capabilities of Network Analyzer for the Bluetooth mesh protocol. Network Analyzer offers the following features:</p><ul id="l25"><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Decryption of the Bluetooth mesh packets at all levels (network, application...)</p></li><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Handles Network-level segmentation / reassembly.</p></li><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Tracing packets from nodes out of RF reach from the PC (over Ethernet)</p></li><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Tracing packets from multiple nodes at once (several WSTKs connected over Ethernet)</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;line-height: 107%;text-align: justify;">As a reminder, Network Analyzer currently supports the Bluetooth mesh 1.0.1 profile and model specification. Support of Bluetooth mesh devices properties is limited. Provisioning Data PDUs cannot be decrypted and the map pane is not reliable.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l26"><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark37">Default IV Index Value</a><a name="bookmark46">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">A Bluetooth mesh live or recorded session that has a non-zero IV index will not be decrypted properly. This can be adjusted in the Bluetooth decoder (<b>Preferences &gt; Network Analyzer &gt; Decoding </b>&gt; <b>Bluetooth</b>) by setting the default IV index value. The following figure illustrates this.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 70pt;text-indent: 0pt;text-align: left;"><span><img width="594" height="297" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_041.jpg"/></span></p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Make sure to import the ISD capture file again to see the change being applied.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">Note: More information on the IV index can be found in <i>AN1318: IV Update in a Bluetooth Mesh Network</i>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark38">Keys</a><a name="bookmark47">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">The Bluetooth mesh stack is composed of several layers, starting from the network layer up to the access layer. Data traffic can be encrypted in various context (that is, stack layer levels):</p></li></ol></li><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Network: Each Bluetooth mesh network has its associated network key. A node can have several network keys.</p></li><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Device: Each device in a particular network has its own device key.</p></li><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Application: Each application, depending on how it is configured, has its own application key.</p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">For more detail on how Bluetooth mesh security and encryption work, refer to the Bluetooth mesh profile specification.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">When building a Bluetooth mesh network using a smart phone application or a gateway, it should be possible to export the corresponding security keys. The security keys can correspond to any of the three types: network, device, or application. The provisioner should allow you to export the keys in a text format that can then be shared with other applications.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">This is useful typically in the case of analyzing network traffic or rebuilding a network from scratch. Network Analyzer can import and export Bluetooth mesh keys. With the Silicon Labs Bluetooth mesh mobile application, a JSON text format is used for keys import/export.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">The following steps indicates how to export keys using the Silicon Labs Bluetooth mesh phone application. Note that the steps are independent from the phone operating system, but the graphic layout of the smart phone application might differ.</p><ol id="l27"><li><p style="padding-top: 3pt;padding-left: 40pt;text-indent: -18pt;text-align: left;">Browse to the export menu.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 223pt;text-indent: 0pt;text-align: left;"><span><img width="183" height="325" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_042.jpg"/></span></p></li><li><p style="padding-top: 8pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Use the Export cryptographic keys button to create the corresponding JSON file. The JSON file called <b>MeshDictionary.json </b>can now be sent via email.</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 226pt;text-indent: 0pt;text-align: left;"><span><img width="176" height="313" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_043.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;text-align: justify;">This should make a menu open allowing the user to select by which mean it wished to send the <b>MeshDictionary.json </b>file.</p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">The content of the (generated) <b>MeshDictionary.json </b>JSON file is human readable text and contains a collection of keywords and hexa- decimal coded Bluetooth mesh keys.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">The following steps indicates how to import the corresponding keys in Network Analyzer.</p><ol id="l28"><li><p style="padding-top: 3pt;padding-left: 40pt;text-indent: -18pt;text-align: left;">Go to <b>Preferences &gt; Network Analyzer &gt; Decoding &gt; Security Keys</b>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 116pt;text-indent: 0pt;text-align: left;"><span><img width="473" height="289" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_044.jpg"/></span></p></li><li><p style="padding-top: 5pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Deselect all default and saved keys that are already present and click <b>Import…</b></p></li><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Browse to the MeshDictionary.json file.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 83pt;text-indent: 0pt;text-align: left;"><span><img width="564" height="209" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_045.jpg"/></span></p></li><li><p style="padding-top: 5pt;padding-left: 37pt;text-indent: -14pt;text-align: justify;">Click <b>Open </b>and see the keys imported in the “Security Keys“ window. For debugging purposes, the decryption keys can be saved in the ISD file (by checking the corresponding checkbox). This is not best practice from a security point of view but is acceptable for debugging. These instructions assume you have checked this.</p></li><li><p style="padding-top: 7pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Click <b>Apply and Close</b>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 117pt;text-indent: 0pt;text-align: left;"><span><img width="462" height="201" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_046.jpg"/></span></p></li><li><p style="padding-top: 8pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">After importing the keyfile, select <b>File &gt; Other Network Analyzer Actions … &gt; Reload </b>to refresh the data.</p></li><li><p style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">Finally, save the ISD file (checkbox in the bottom left of the security key dialog box).</p></li></ol><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The access layer Bluetooth mesh data should now be decrypted. The following sections show the expected result, in green on the top right corner of the figures.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l29"><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark39">Bluetooth Mesh Advertising Packets</a><a name="bookmark48">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The Bluetooth mesh technology is based on Bluetooth LE advertising packets. Bluetooth mesh traffic is differentiated from the regular Bluetooth LE traffic through the AD types used by the Bluetooth mesh advertising packets. Network Analyzer can filter advertising packets in a number of ways.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The following AD types are used for advertising bearer-based Bluetooth mesh traffic:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:23.25pt" cellspacing="0"><tr style="height:15pt"><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A6A6A6"><p class="s15" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">AD Type value</p></td><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A6A6A6"><p class="s15" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Data type name</p></td><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A6A6A6"><p class="s15" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Reference for definition</p></td></tr><tr style="height:25pt"><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">0x29</p></td><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">PD-ADV</p></td><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 1pt;padding-left: 5pt;padding-right: 30pt;text-indent: 0pt;text-align: left;">Bluetooth Mesh Profile specification section 5.2.1</p></td></tr><tr style="height:25pt"><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">0x2A</p></td><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Mesh Message</p></td><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 2pt;padding-left: 5pt;padding-right: 30pt;text-indent: 0pt;text-align: left;">Bluetooth Mesh Profile specification section 3.3.1</p></td></tr><tr style="height:25pt"><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">0x2B</p></td><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Mesh Beacon</p></td><td style="width:180pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 2pt;padding-left: 5pt;padding-right: 30pt;text-indent: 0pt;text-align: left;">Bluetooth Mesh Profile specification section 3.9</p></td></tr></table><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">Based on this information, Bluetooth mesh advertising packets can be filtered. The following filters can be entered in the filter bar:</p></li></ol></li><li><p class="s9" style="padding-top: 3pt;padding-left: 37pt;text-indent: -14pt;text-align: justify;">bleAdv.adv_type_0 == 0x2b. <span class="p">This shows only Bluetooth mesh beacons that are used essentially for provisioning and secure data information propagation (secure beacons). The following shows an example.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 83pt;text-indent: 0pt;text-align: left;"><span><img width="558" height="401" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_047.jpg"/></span></p></li><li><p class="s9" style="padding-top: 5pt;padding-left: 37pt;text-indent: -14pt;text-align: justify;">bleAdv.adv_type_0 == 0x2a<span class="p">. Shows Bluetooth mesh messages. Bluetooth mesh messages are used for common Bluetooth mesh data traffic. The payload of those mesh advertising packets is called “Network PDUs” (specified by the Bluetooth mesh profile specification). “Network PDUs” are the containers of the Network layer data. This is very useful because it allows you to display only the data traffic using the advertising bearer on provisioned nodes in a network. The following figure shows an example:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 107pt;text-indent: 0pt;text-align: left;"><span><img width="495" height="356" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_048.jpg"/></span></p></li><li><p class="s9" style="padding-top: 7pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">bleAdv.adv_type_0 == 0x29<span class="p">. This shows Bluetooth mesh provisioning advertising packets. Those packets use the PB-ADV provisioning bearer and are used to provision a device using “Provisioning PDUs”.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l30"><li><p class="s8" style="padding-left: 51pt;text-indent: -28pt;text-align: left;"><a name="bookmark40">Proxy Protocol</a><a name="bookmark49">&zwnj;</a></p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">The Bluetooth mesh technology is mainly based on Bluetooth LE advertisement packets used along with Bluetooth mesh AD types. Nevertheless, in some cases, some devices are not able to advertise using the Bluetooth mesh AD types. As a consequence, the Blue- tooth mesh specification allows communication over a GATT connection and uses what is called the Proxy protocol to exchange Network PDUs.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">The proxy protocol is designed to enable nodes to send and receive Bluetooth mesh network packets over a connection-oriented bearer. As mentioned earlier, a node could support GATT but not be able to advertise the Bluetooth mesh Message AD Type. This node will establish a GATT connection with another node that supports the Bluetooth LE ATT bearer, called GATT bearer, and the advertising bearer, using the Proxy protocol to forward messages between these bearers.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s8" style="padding-left: 59pt;text-indent: -36pt;text-align: left;">Note: <span class="p">The term &quot;GATT bearer&quot;, in effect, corresponds exactly to the ATT bearer as specified in the Bluetooth Host specification (Blue- tooth Core specification, Host Vol. 3, 3.2.11).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 107%;text-align: justify;">Once the Bluetooth LE connection is established, the node can send and receive what are called &quot;Proxy PDUs&quot;. A Proxy PDU is essen- tially a data container for the following PDUs:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:23.25pt" cellspacing="0"><tr style="height:15pt"><td style="width:135pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A6A6A6"><p class="s15" style="padding-top: 2pt;padding-left: 56pt;text-indent: 0pt;text-align: left;">Type</p></td><td style="width:153pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A6A6A6"><p class="s15" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Name</p></td><td style="width:252pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A6A6A6"><p class="s15" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Description</p></td></tr><tr style="height:25pt"><td style="width:135pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">0x00</p></td><td style="width:153pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Network PDU</p></td><td style="width:252pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 1pt;padding-left: 5pt;padding-right: 8pt;text-indent: 0pt;text-align: left;">The message is a Network PDU as defined in Section 3.4.4 of the profile spec.</p></td></tr><tr style="height:25pt"><td style="width:135pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">0x01</p></td><td style="width:153pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Mesh Beacon</p></td><td style="width:252pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 1pt;padding-left: 5pt;padding-right: 23pt;text-indent: 0pt;text-align: left;">The message is a Bluetooth mesh beacon as defined in Section 3.9. of the profile spec.</p></td></tr><tr style="height:25pt"><td style="width:135pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">0x02</p></td><td style="width:153pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Proxy Configuration</p></td><td style="width:252pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 1pt;padding-left: 5pt;padding-right: 12pt;text-indent: 0pt;text-align: left;">The message is a proxy configuration message as defined in Section 6.5. of the profile spec.</p></td></tr><tr style="height:25pt"><td style="width:135pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">0x03</p></td><td style="width:153pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 7pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Provisioning PDU</p></td><td style="width:252pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s16" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;line-height: 10pt;text-align: left;">The message is a Provisioning PDU as defined in Section</p><p class="s16" style="padding-left: 5pt;text-indent: 0pt;line-height: 10pt;text-align: left;">5.4.1. of the profile spec.</p></td></tr></table><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The Network PDU corresponds to all messages handled at the &quot;Network Layer&quot;.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Network Analyzer allows you to filter Bluetooth mesh GATT bearer data in a live (or recorded) network session. Based on this information, Bluetooth mesh packets can be filtered. The following filters can be entered in the filter bar:</p></li></ol></li><li><p class="s9" style="padding-top: 7pt;padding-left: 37pt;text-indent: -14pt;text-align: justify;">btMeshProxy.type == 0x0<span class="p">. This shows all Network layer traffic. This is the GATT bearer equivalent to filter Bluetooth mesh Messages on advertising bearer traffic. The following figure shows an example (note the application and network key data in green in the top right corner).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 108pt;text-indent: 0pt;text-align: left;"><span><img width="488" height="318" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_049.jpg"/></span></p></li><li><p class="s9" style="padding-top: 8pt;padding-left: 37pt;text-indent: -14pt;text-align: justify;">btMeshProxy.type == 0x1<span class="p">. This shows Bluetooth mesh beacons on GATT bearer. The following figure shows an example, and shows an example of the secure beacon:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 101pt;text-indent: 0pt;text-align: left;"><span><img width="505" height="328" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_050.jpg"/></span></p></li><li><p class="s9" style="padding-top: 7pt;padding-left: 37pt;text-indent: -14pt;text-align: justify;">btMeshProxy.type == 0x2<span class="p">. This shows Proxy client and server configuration messages. Proxy configuration messages are used to configure the proxy filters. The proxy server uses a filter to decide whether to forward the message to the proxy client or not. In practice that filter is only useful in certain specific cases.</span></p></li><li><p class="s9" style="padding-top: 7pt;padding-left: 37pt;text-indent: -14pt;text-align: left;">btMeshProxy.type == 0x3<span class="p">. This shows Provisioning PDUs over the GATT bearer. This is the GATT bearer equivalent of filtering PB-ADV adverting packet on advertising bearer Bluetooth mesh traffic. The following figure shows an example:</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 98pt;text-indent: 0pt;text-align: left;"><span><img width="519" height="337" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_051.jpg"/></span></p><p class="s8" style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">When using Bluetooth mesh, the node map may not be totally reliable. This is a known issue in Network Analyzer.</span></p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Alternatively, filtering can be done on both bearers using frame patterns. When selecting a packet containing Bluetooth mesh Network layer data, in the Event detail pane, right-click the Bluetooth mesh Network data of that packet and click <b>Filter by Frame Pattern</b>. This filters all Network messages regardless of the bearer. The same procedure can be done with Bluetooth mesh beacons and provisioning PDUs.</p><p class="s7" style="padding-bottom: 2pt;padding-left: 320pt;text-indent: 0pt;text-align: left;">Bluetooth Mesh Networking and the Network Analyzer.</p><p style="padding-left: 21pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="724" height="1" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_052.png"/></span></p></li></ol></li><li><h4 style="padding-top: 7pt;padding-left: 40pt;text-indent: -18pt;text-align: left;"><a name="bookmark50">Bluetooth Mesh Networking and the Network Analyzer.</a><a name="bookmark51">&zwnj;</a></h4></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;text-align: justify;">In a Bluetooth mesh network, especially on the field, node access can be challenging. Even when accessible, all nodes might not have the PTI pins exposed allowing network monitoring.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">This section describes briefly what techniques can be used to monitor the Bluetooth mesh traffic in such environments.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">The Silicon Labs recommendation for this use case is to set up a WSTK-based proxy node. That would be, in effect, a dedicated sniffer node. The sniffer node does not need to run any particular model beyond the basics. It would only need to have the network key associated with the Bluetooth mesh network to decipher the traffic.</p><p style="padding-top: 8pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Using a mobile phone application, connect to the proxy sniffer node that would be used with the Network Analyzer to see the Bluetooth mesh traffic. That way, not only traffic on the advertising channels can be monitored but also data using the GATT bearer. This can be quite helpful when debugging issues that occur between the mobile phone application and the nodes.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 120pt;text-indent: 0pt;text-align: left;"><span><img width="453" height="231" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_053.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 107%;text-align: justify;">Alternatively, a sniffer node can be created in a Bluetooth mesh network by simply loading a demo or sample application that is constantly scanning onto a WSTK-based Bluetooth LE device (i.e. an EFR32BG radio board mounted on a WSTK).</p><p class="s12" style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark45" class="a">As an example, the soc-thermometer-host, constantly scanning for health thermometer server devices, would receive all Bluetooth mesh advertising-based PDUs. The fact that it is not a Bluetooth mesh node is not a problem as this can be recorded and decoded later on in Network Analyzer (see section </a><a href="#bookmark45" class="s11">4.2 </a>Network Analyzer for Bluetooth Mesh<span style=" color: #000;">)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 124pt;text-indent: 0pt;text-align: left;"><span><img width="451" height="267" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_054.png"/></span></p><p style="padding-top: 6pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;">Although this type of sniffer is very useful in the field, it has a couple of limitations: GATT bearer Bluetooth mesh data would not be sniffed and only packets within radio range will be caught. In practice, the latter can be mitigated if the sniffer node is close to a relay node.</p><p style="padding-top: 7pt;padding-left: 22pt;text-indent: 0pt;text-align: justify;"><a href="https://github.com/SiliconLabs/java_packet_trace_library" class="a" target="_blank">Finally, a standalone Java-based packet trace tool exist that is worth mentioning. The data stream recorded can be decoded in Network Analyzer (and Wireshark) or can simply be stored in text or binary format. For more detail, refer to </a><a href="https://github.com/SiliconLabs/java_packet_trace_library" class="s6" target="_blank">Github</a><a href="https://github.com/SiliconLabs/java_packet_trace_library" target="_blank">.</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 36pt;text-indent: 0pt;text-align: left;">Simplicity Studio</h2><p class="s21" style="padding-top: 14pt;padding-left: 36pt;text-indent: 0pt;line-height: 122%;text-align: left;">One-click access to MCU and wireless tools, documentation, software, source code libraries &amp; more. Available for Windows, Mac and Linux!</p><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><span><img width="768" height="432" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_055.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:63.94pt" cellspacing="0"><tr style="height:99pt"><td style="width:98pt" bgcolor="#231F20"><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 15pt;text-indent: 0pt;text-align: left;"><span><img width="66" height="66" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_056.png"/></span></p><p style="padding-top: 10pt;padding-left: 1pt;padding-right: 19pt;text-indent: 0pt;text-align: center;"><a href="https://www.silabs.com/solutions/iot" class="s22">IoT Portfolio</a></p><p style="padding-top: 1pt;padding-left: 1pt;padding-right: 19pt;text-indent: 0pt;line-height: 8pt;text-align: center;"><a href="http://www.silabs.com/IoT" class="s23">www.silabs.com/IoT</a></p></td><td style="width:126pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 18pt;padding-right: 8pt;text-indent: 0pt;text-align: center;"><a href="https://www.silabs.com/simplicity" class="s22">SW/HW</a></p><p style="padding-top: 1pt;padding-left: 18pt;padding-right: 8pt;text-indent: 0pt;line-height: 8pt;text-align: center;"><a href="http://www.silabs.com/simplicity" class="s23">www.silabs.com/simplicity</a></p></td><td style="width:126pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 18pt;padding-right: 8pt;text-indent: 0pt;text-align: center;"><a href="https://www.silabs.com/about-us/corporate-responsibility/commitment-to-quality" class="s22">Quality</a></p><p style="padding-top: 1pt;padding-left: 18pt;padding-right: 8pt;text-indent: 0pt;line-height: 8pt;text-align: center;"><a href="http://www.silabs.com/quality" class="s23">www.silabs.com/quality</a></p></td><td style="width:126pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 12pt;text-indent: 0pt;text-align: left;"><a href="https://www.silabs.com/community" class="s22" target="_blank">Support &amp; Community</a></p><p style="padding-top: 1pt;padding-left: 13pt;text-indent: 0pt;line-height: 8pt;text-align: left;"><a href="http://www.silabs.com/community" class="s23">www.silabs.com/community</a></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="131" height="131" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_057.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="131" height="131" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_058.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="131" height="131" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_059.png"/></span></p><p class="s24" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Disclaimer</p><p class="s25" style="padding-left: 5pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">Silicon Labs intends to provide customers with the latest, accurate, and in-depth documentation of all peripherals and modules available for system and software imple- menters using or intending to use the Silicon Labs products. Characterization data, available modules and peripherals, memory sizes and memory addresses refer to each <span class="s26">specific device, and “Typical” parameters provided can and do vary in different applications. Application examples described herein are for illustrative purposes only. Silicon Labs reserves the right to make changes without further notice to the product information, specifications, and descriptions herein, and does not give warranties as to the accuracy or completeness of the included information. Without prior notification, Silicon Labs may update product firmware during the manufacturing process for security or reliability reasons. Such changes will not alter the specifications or the performance of the product. Silicon Labs shall have no liability for the consequences of use of the infor</span>- mation supplied in this document. This document does not imply or expressly grant any license to design or fabricate any integrated circuits. The products are not designed or <span class="s26">authorized to be used within any FDA Class III devices, applications for which FDA premarket approval is required or Life Support Systems without the specific written consent of Silicon Labs. A “Life Support System” is any product or system intended to support or sustain life and/or health, which, if it fails, can be reasonably expected to result in significant personal injury or death. Silicon Labs products are not designed or authorized for military applications. Silicon Labs products shall under no circumstances be used </span>in weapons of mass destruction including (but not limited to) nuclear, biological or chemical weapons, or missiles capable of delivering such weapons. Silicon Labs disclaims <span class="s26">all express and implied warranties and shall not be responsible or liable for any injuries or damages related to use of a Silicon Labs product in such unauthorized applications. </span><b>Note: This content may contain offensive terminology that is now obsolete. Silicon Labs is replacing these terms with inclusive language wherever possible. For more </b><span class="s28">information, visit </span><a href="https://www.silabs.com/about-us/inclusive-lexicon-project" class="s30" target="_blank">www.silabs.com/about-us/inclusive-lexicon-project</a></p><p class="s28" style="padding-top: 8pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Trademark Information</p><p class="s31" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;line-height: 117%;text-align: justify;"><span class="s25">Silicon Laboratories Inc.</span>®<span class="s25">, Silicon Laboratories</span>®<span class="s25">, Silicon Labs</span>®<span class="s25">, SiLabs</span>® <span class="s25">and the Silicon Labs logo</span>®<span class="s25">, Bluegiga</span>®<span class="s25">, Bluegiga Logo</span>®<span class="s25">, Clockbuilder</span>®<span class="s25">, CMEMS</span>®<span class="s25">, DSPLL</span>®<span class="s25">, EFM</span>®<span class="s25">, EFM32</span>®<span class="s25">, EFR, Ember</span>®<span class="s26">, Energy Micro, Energy Micro logo and combinations thereof, “the world’s most energy friendly microcontrollers”, Ember</span>®<span class="s25">, EZLink</span>®<span class="s25">, EZRadio</span>®<span class="s25">, EZRadioPRO</span>®<span class="s25">, Gecko</span>®<span class="s25">, Gecko OS, Gecko OS Studio, ISOmodem</span>®<span class="s25">, Precision32</span>®<span class="s25">, ProSLIC</span>®<span class="s25">, Simplicity Studio</span>®<span class="s25">, SiPHY</span>®<span class="s25">, Telegesis, the Telegesis Logo</span>®<span class="s25">, USBXpress</span>® <span class="s25">, Zentri, the Zentri logo and Zentri DMS, Z-Wave</span>®<span class="s25">, and others are trademarks or registered trademarks of Silicon Labs. ARM, CORTEX, Cortex-M3 and THUMB are trademarks or registered trademarks of ARM Hold- ings. Keil is a registered trademark of ARM Limited. Wi-Fi is a registered trademark of the Wi-Fi Alliance. All other products or brand names mentioned herein are trademarks of their respective holders.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="148" height="73" alt="image" src="an1317-network-analyzer-with-bluetooth-mesh-le/Image_060.png"/></span></p><p class="s28" style="padding-top: 5pt;padding-left: 149pt;text-indent: 0pt;text-align: left;">Silicon Laboratories Inc. 400 West Cesar Chavez Austin, TX 78701</p><p class="s28" style="padding-left: 149pt;text-indent: 0pt;line-height: 8pt;text-align: left;">USA</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 149pt;text-indent: 0pt;text-align: left;"><h3 href="http://www.silabs.com/">www.silabs.com</h3></p></body></html>
