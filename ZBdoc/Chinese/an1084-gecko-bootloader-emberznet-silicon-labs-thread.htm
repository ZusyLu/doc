<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>an1084-gecko-bootloader-emberznet-silicon-labs-thread</title><style type="text/css"> * {margin:0; padding:0; text-indent:0; }
 h1 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 24pt; }
 .s1 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6pt; }
 .s2 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s3 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s5 { color: #D81E2A; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 h3 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; }
 .p, p { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; margin:0pt; }
 .a { color: #049; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s7 { color: #049; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s8 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 .s9 { color: black; font-family:"Courier New", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s10 { color: black; font-family:"Courier New", monospace; font-style: italic; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s11 { color: black; font-family:"Courier New", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s12 { color: black; font-family:"Courier New", monospace; font-style: italic; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s13 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 .s14 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s15 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 h4 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .s16 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8pt; }
 .s17 { color: #FFF; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s18 { color: #FFF; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s19 { color: #231F20; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7pt; }
 .s20 { color: #231F20; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 h2 { color: #D91F2A; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 14pt; }
 li {display: block; }
 #l1 {padding-left: 0pt; }
 #l1> li>*:first-child:before {content: "• "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 li {display: block; }
 #l2 {padding-left: 0pt;counter-reset: d1 1; }
 #l2> li>*:first-child:before {counter-increment: d1; content: counter(d1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; }
 #l2> li:first-child>*:first-child:before {counter-increment: d1 0;  }
 #l3 {padding-left: 0pt;counter-reset: d2 1; }
 #l3> li>*:first-child:before {counter-increment: d2; content: counter(d1, decimal)"."counter(d2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l3> li:first-child>*:first-child:before {counter-increment: d2 0;  }
 #l4 {padding-left: 0pt;counter-reset: d3 1; }
 #l4> li>*:first-child:before {counter-increment: d3; content: counter(d3, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l4> li:first-child>*:first-child:before {counter-increment: d3 0;  }
 #l5 {padding-left: 0pt;counter-reset: e1 1; }
 #l5> li>*:first-child:before {counter-increment: e1; content: counter(e1, decimal)". "; color: black; font-family:"Courier New", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 #l5> li:first-child>*:first-child:before {counter-increment: e1 0;  }
 #l6 {padding-left: 0pt;counter-reset: f1 1; }
 #l6> li>*:first-child:before {counter-increment: f1; content: counter(f1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l6> li:first-child>*:first-child:before {counter-increment: f1 0;  }
 #l7 {padding-left: 0pt; }
 #l7> li>*:first-child:before {content: "• "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l8 {padding-left: 0pt; }
 #l8> li>*:first-child:before {content: "• "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l9 {padding-left: 0pt;counter-reset: h1 3; }
 #l9> li>*:first-child:before {counter-increment: h1; content: counter(h1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; }
 #l9> li:first-child>*:first-child:before {counter-increment: h1 0;  }
 #l10 {padding-left: 0pt;counter-reset: h2 1; }
 #l10> li>*:first-child:before {counter-increment: h2; content: counter(h1, decimal)"."counter(h2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l10> li:first-child>*:first-child:before {counter-increment: h2 0;  }
 table, tbody {vertical-align: top; overflow: visible; }
</style></head><body><p style="padding-left: 24pt;text-indent: 0pt;text-align: left;"><span><img width="126" height="62" alt="image" src="an1084-gecko-bootloader-emberznet-silicon-labs-thread/Image_001.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-top: 4pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">AN1084: Using the Gecko Bootloader with EmberZNet</h1><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="713" height="1" alt="image" src="an1084-gecko-bootloader-emberznet-silicon-labs-thread/Image_002.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="189" height="1" alt="image" src="an1084-gecko-bootloader-emberznet-silicon-labs-thread/Image_003.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s1" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">KEY POINTS</p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="190" height="1" alt="image" src="an1084-gecko-bootloader-emberznet-silicon-labs-thread/Image_004.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l1"><li><p class="s2" style="padding-top: 4pt;padding-left: 17pt;text-indent: -7pt;text-align: left;">Gecko Bootloader overview.</p></li><li><p class="s2" style="padding-top: 3pt;padding-left: 17pt;text-indent: -7pt;text-align: left;">Using Gecko standalone bootloaders.</p></li><li><p class="s2" style="padding-top: 3pt;padding-left: 17pt;text-indent: -7pt;text-align: left;">Using Gecko application bootloaders.</p></li></ul><p style="text-indent: 0pt;text-align: left;"/><p class="s3" style="padding-left: 23pt;text-indent: 0pt;text-align: justify;">This application note includes detailed information on using the Silicon Labs Gecko Bootloader with EmberZNet. It supplements the general Gecko Bootloader implementation information provi- ded in <i>UG266: Silicon Labs Gecko Bootloader User’s Guide</i>. If you are not familiar with the basic principles of performing a firm- ware upgrade or want more information about upgrade image files, refer to <i>UG103.6: Bootloading Fundamentals</i>.</p><p class="s5" style="padding-bottom: 3pt;text-indent: 0pt;text-align: right;">Overview</p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="713" height="0" alt="image" src="an1084-gecko-bootloader-emberznet-silicon-labs-thread/Image_005.png"/></span></p><ol id="l2"><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark0">Overview</a></h3><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: justify;">The Silicon Labs Gecko Bootloader is a common bootloader for all the newer MCUs and wireless MCUs from Silicon Labs. The Gecko Bootloader can be configured to perform a variety of bootload functions, from device initialization to firmware upgrades. The Gecko Bootloader uses a proprietary format for its upgrade images, called GBL (Gecko Bootloader). These images are produced with the file extension “.gbl”. Additional information on the GBL file format is provided in <i>UG103.6: Bootloading Fundamentals</i>.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">On EFR32 Series 1 devices, the Gecko Bootloader has a two-stage design, first stage and main stage, where a minimal first stage bootloader is used to upgrade the main bootloader. The first stage bootloader only contains functionality to read from and write to fixed addresses in internal flash. To perform a main bootloader upgrade, the running main bootloader verifies the integrity and authenticity of the bootloader upgrade image file. The running main bootloader then writes the upgrade image to a fixed location in intermal flash and issues a reboot into the first stage bootloader. The first stage bootloader verifies the integrity of the main bootloader firmware upgrade image by computing a CRC32 checksum, before copying the upgrade image to the main bootloader location.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">On EFR32 Series 2 devices, the Gecko bootloader consists only of the main stage bootloader. The main bootloader is upgradable through the hardware peripheral Secure Element. The Secure Element provides functionality to install an image to address 0x0 in inter- nal flash, by copying from a configurable location in internal flash. To perform a main bootloader upgrade, the running main bootloader verifies the integrity and authenticity of the bootloader upgrade image file. The running main bootloader then writes the upgrade image to the upgrade location in flash and requests that the Secure Element installs it. On some devices, the Secure Element is also capable of verifying the authenticity of the main bootloader upgrade image against a root of trust. The Secure Element itself is upgradable using the same mechanism. More details are provided in <i>UG266: Silicon Labs Gecko Bootloader User’s Guide</i>.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The Gecko Bootloader can be configured to perform firmware upgrades in standalone mode (also called a standalone bootloader) or in application mode (also called an application bootloader), depending on the plugin configuration. Plugins can be enabled and configured through the Simplicity Studio IDE.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">A standalone bootloader uses a communications channel to get a firmware upgrade image. NCP (network co-processor) devices al- ways use standalone bootloaders. Standalone bootloaders perform firmware image upgrades in a single-stage process that allows the application image to be placed into flash memory, overwriting the existing application image, without the participation of the application itself. In general, the only time that the application interacts with a standalone bootloader is when it requests to reboot into the bootload- er. Once the bootloader is running, it receives packets containing the firmware upgrade image by a physical connection such as UART or SPI. To function as a standalone bootloader, a plugin providing a communication interface such as UART or SPI must be configured.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">An application bootloader relies on the application to acquire the firmware upgrade image. The application bootloader performs a firm- ware image upgrade by reprogramming the device’s flash with the firmware upgrade image stored in a region of flash memory referred to as the download space. The application transfers the firmware upgrade image to the download space in any way that is convenient (UART, over-the-air, and so on). The download space is either an external memory device such as an EEPROM or dataflash or a sec- tion of the chip’s internal flash. The Gecko Bootloader can partition the download space into multiple storage slots, and store multiple firmware upgrade images simultaneously. To function as an application bootloader, a plugin providing a bootloader storage implemen- tation has to be configured.</p><p style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">This document describes how to use both models with EmberZNet.</p></li><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark1">Using the Gecko Standalone Bootloaders</a></h3><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s7" style="padding-left: 23pt;text-indent: 0pt;text-align: justify;"><a href="http://en.wikipedia.org/wiki/%20XMODEM" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;" target="_blank">A Gecko Bootloader-based standalone bootloader receives an application image onto a target device by serial transfer via SPI or UART. If using UART, you can establish a serial connection between a source device and a target device’s serial interface and upload a new software image to it using the XModem protocol. If you need information on the XModem protocol, a good place to start is </a><a href="http://en.wikipedia.org/wiki/%20XMODEM" class="a" target="_blank">http:// </a>en.wikipedia.org/wiki/XMODEM<span style=" color: #000;">, which should have a brief description and up-to-date links to protocol documentation.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l3"><li><p class="s8" style="padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark2">Performing a Serial Upload – UART XMODEM Bootloader</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Serial upload can be performed with any source device that provides the expected serial interface method. This can be a Windows- based PC, a Linux or Mac OS-based device, or an embedded MCU with no operating system. UART transfer can be done with a third- party serial terminal program like Windows HyperTerminal or Linux “lrzsz” or with user-compiled host code. However, drivers for SPI Master or UART may vary with operating systems, and serial terminal programs may vary in timing and performance, so if you are unsure about what driver or program to use on your source code, please consult Silicon Labs technical support.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">To open a serial connection over UART, the source device connects to the target device at 115,200 baud, 8 data bits, no parity bit, and 1 stop bit (8-N-1), with no flow control by default. These options may be changed using the plugin options in the Bootloader AppBuilder project.</p><p class="s8" style="padding-top: 6pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">The UART-based serial bootloader configurations do not employ any flow control in the communication channel by default, be- cause the XModem protocol used for image transfer already has built-in flow control mechanisms. However, Silicon Labs’ normally- supplied NCP firmware does utilize either hardware-based (RTS/CTS) or software-based (XON/XOFF) flow control, so a host device must take care to temporarily disable the flow control when placing its NCP into serial bootloading mode. Alternatively, application de- signers can change the options in the provided bootloader project and customize the serial bootloader’s handling of the UART to add hardware flow control at their discretion.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Once the connection with a UART-based serial bootloader is established:</p><ol id="l4"><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;">The target device’s bootloader sends output over its serial port after it receives a carriage return from the source device at the expected baud rate. This prevents the bootloader from prematurely sending commands that might be misinterpreted by other devi- ces that are connected to the serial port. Note that serial bootloaders typically don’t enforce any timeout when awaiting the initial serial handshake via carriage return, so the bootloader will wait indefinitely in this mode until guided by the source device or until the chip is reset.</p></li><li><p style="padding-top: 2pt;padding-left: 42pt;text-indent: -8pt;text-align: justify;">After the bootloader receives a carriage return from the target device, it displays a menu with the following ASCII-based output (where X.Y.A corresponds to the major, minor, and sub-minor fields of the bootloader version number, respectively:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Gecko Bootloader vX.Y.A</p><ol id="l5"><li><p class="s9" style="padding-left: 17pt;text-indent: -14pt;text-align: left;">upload gbl</p></li><li><p class="s9" style="padding-left: 17pt;text-indent: -14pt;text-align: left;">run</p></li><li><p class="s9" style="padding-left: 2pt;text-indent: 0pt;line-height: 107%;text-align: left;">ebl info BL &gt;</p></li></ol><p style="padding-left: 39pt;text-indent: 0pt;text-align: left;"/><p class="s8" style="padding-top: 4pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">The third menu option has no effect. While current menu options should remain functionally unchanged, the menu title and op- tions text is liable to change, and new options might be added.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">After listing the menu options, the bootloader&#39;s “BL &gt;” prompt displays, and the ASCII character corresponding to the number of each option can then be entered by the source to select the described action, such as ‘2’ (ASCII code 0x32) to run the firmware presently loaded in the application area. Here again, no timeout is enforced by the bootloader, so it will wait indefinitely until a character is re- ceived or the chip is reset. Note that while the menu interface is designed for human interaction, the transfer can still be performed programmatically or through a scripted interface, provided the source device sends the expected ASCII characters to the target at ap- propriate times.</p><p class="s8" style="padding-top: 6pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">Note: <span class="p">Scripts that interact with the bootloader should use only the “BL &gt;” prompt to determine when the bootloader is ready for input.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">Selecting menu option 1 initiates upload of a new software image to the target device, which unfolds as follows:</p><ol id="l6"><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">The target device awaits an XModem CRC upload of a GBL file over the expected serial interface, as indicated by the stream of C characters that its bootloader transmits.</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">If no transaction is initiated within 60 seconds, the bootloader times out and returns to the menu.</p></li><li><p style="padding-top: 3pt;padding-left: 42pt;text-indent: -8pt;text-align: left;">Once uploading begins (first XModem SOH data packet received), the bootloader expects each successive XModem SOH packet within 1 second, or else a timeout error will be generated and the session will abort.</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">After an image successfully uploads, the XModem transaction completes and the bootloader displays ‘Serial upload complete’ be- fore redisplaying the menu.</p></li></ol></li></ol></li><li><p class="s8" style="padding-top: 8pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark3">Performing a Serial Upload - SPI</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">To open a serial connection over SPI, the source device must act as SPI Master using Mode 0 or Mode 2. It must also react to edge- triggered interrupts from the slave device using the same nHOST_INT logic and SPI framing as the EZSP-SPI protocol described in <i>AN711: EZSP-SPI Host Interfacing Guide</i>.</p><p class="s7" style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark9" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;">Once the SPI slave enters bootloader mode, which includes a reset sequence with host interrupt and Reset response frame similar to the reset sequence of a normal EZSP-SPI NCP, the bootloader sits in a Waiting state looking for SPI input in the form of bootloader packets (SPI bootloader frames with 0xFD SPI byte). The source device then must perform a bootloader Query transaction, which in- volves the source sending a Query packet and expecting a Response packet. Note that the first Query transaction yields a Query- Found result (status byte 0x1A), while the subsequent Query will yield the expected Response result (status byte ‘R’ or 0x52). For de- tails, refer to the sample SPI bootloading process described in section </a>2.3 Sample EZSP-SPI Bootloader Transcript<span style=" color: #000;">.</span></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Once a query transaction has completed successfully, that is with expected Response frame, the transfer of data packets can begin. The transfer process follows standard XModem-CRC protocol, just like the UART-based serial bootloader uses, but with SPI framing similar to that used to encapsulate EZSP data frames. This SPI-based XModem adaptation adheres to the following rules, some of which may differ from the SPI protocol used by the normal EZSP NCP firmware:</p><ul id="l7"><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">The 0xFD SPI byte and a length byte (for number of bytes to follow) prefix every command or response frame.</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">The 0xA7 frame terminator byte concludes every SPI command or response frame. This byte is not included in the length count used in the length byte.</p></li><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">The NCP operates as a SPI slave, so nSSEL must be asserted before each transaction.</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">No EZSP frame control bytes are used in the SPI frame. Consequently, no sleep mode operation is supported by the target during the bootload.</p></li><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">SPI timing (timeouts, signal transitions) are similar to EZSP. See <i>AN711: EZSP-SPI Host Interfacing Guide </i>for details.</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">The nHOST_INT signal is asserted by the target to indicate a pending response.</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: justify;">In place of the EZSP “callbacks” command, the host should use the bootloader’s Query packet to prompt the target to push the asynchronous response such as XModem ACK back to the host.</p></li><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: justify;">Each SPI frame typically generates an initial, synchronous response from the target, such as a BLOCKOK status, and a follow-up, asynchronous response, which must be queried for by the host. For example, the EOT packet generates a synchronous response with FILEDONE status, then Query transaction yields XModem ACK with block number of lastBlock+1 before rebooting into new firmware.</p></li><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: justify;">The host must wait for nHOST_INT to assert (become low) before querying for status, as the SPI bootloader is edge-triggered rather than level triggered. Thus, acting too fast at the host side can cause an edge transition to be missed and the bootloading state ma- chines at the host and NCP to get out of synchronization, resulting in problems later on.</p></li><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: justify;">SPI Status and SPI Version commands (SPI bytes 0x0A and 0x0B) are still supported.</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: justify;">Prior to the first data block being processed, the SPI bus is polled at a rate of once per second.</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">Once the data transmission begins (first block processed), the bootloader will wait up to 60 seconds for the next data packet, polling at 5-second intervals.</p></li><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">If either of the timeouts above is exceeded, the bootloader signals a cancellation (CAN frame) and reboots, restarting the state ma- chine.</p></li><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">XModem data packets consist of:</p><ul id="l8"><li><p style="padding-top: 3pt;padding-left: 48pt;text-indent: -9pt;text-align: left;">The SOH byte (ASCII 0x01)</p></li><li><p style="padding-top: 3pt;padding-left: 48pt;text-indent: -9pt;text-align: left;">A 1-byte incrementing block number (beginning at 1 and wrapping back around from 255 to 0)</p></li><li><p style="padding-top: 3pt;padding-left: 48pt;text-indent: -9pt;text-align: left;">The block number’s complement</p></li><li><p style="padding-top: 3pt;padding-left: 48pt;text-indent: -9pt;text-align: left;">128 bytes of data read directly from the GBL file being uploaded</p></li><li><p style="padding-top: 3pt;padding-left: 48pt;text-indent: -9pt;text-align: left;">A 16-bit CRC of the data bytes from that packet</p></li></ul></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: justify;">Each packet is followed by an XModem ACK or NAK from the target device (the NCP running the bootloader), which confirms or refutes the current data packet.</p></li><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: justify;">If the target receives a duplicate block, it simply sends the ACK for that block again. If the target receives a block that had an XMo- dem frame error (such as bad CRC), the bootloader expects that data block to be retransmitted and then the bootload can continue. Other kinds of errors are considered unrecoverable and cause the bootload to abort.</p></li><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: justify;">If the bootload process aborts for any reason (including receiving an XModem Cancel (CAN) frame from the source), an XModem Cancel frame is echoed on the SPI interface from the target and the target then reboots, restarting the bootloader state machine.</p></li><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: justify;">When the source device reaches the last XModem data block, it should be padded to 128 bytes of data using SUB (ASCII 0x1A) characters.</p></li><li><p style="padding-top: 8pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">Once the last block is ACKed by the target, the transfer should be finalized by an EOT (ASCII 0x04) packet from the source. Once this packet is confirmed via XModem ACK from the target, the device reboots, causing the new firmware to be launched.</p></li></ul><p class="s8" style="padding-top: 6pt;padding-left: 36pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">The ACK for the last XModem data packet may take much longer (1-3 seconds) to be received than prior data packets. This is due to the CRC32 checksum and optional GBL file signature verification being performed across the received GBL file data before sending the ACK. The source device must ensure that its SPI XModem state machine waits a sufficient amount of time to allow this checksum process to occur without timing out on the response just before the EOT is sent.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s8" style="padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark4">Sample EZSP-SPI Bootloader Transcript</a><a name="bookmark9">&zwnj;</a></p><p style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">The following is a record of the SPI frames transmitted and received by the EZSP-SPI host during the SPI bootload process, as cap- tured from an EZSP Host application running the <b>ota-bootload-ncp-spi.c </b>state machine from the Silicon Labs Zigbee application framework&#39;s OTA Platform Bootloader plugin with an EZSP-SPI NCP device as target using the ezsp-spi-bootloader.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">A “TX:” line means that the hexadecimal byte values contained in brackets (“[ … ]”) are transmitted by the source via SPI to the target. An “RX:” line means that the byte values that follow in brackets are received by the source via SPI from the target NCP device.</p><p class="s8" style="padding-top: 6pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">Firmware data (in the form of an EBL file for an EZSP-SPI NCP) is being streamed to the host’s UART (for relaying down to the target) during this process, but that serial stream is not shown here.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Comments about the process are indicated in italics and are not part of the data transmitted on the SPI bus.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:20.0828pt" cellspacing="0"><tr style="height:13pt"><td style="width:454pt" colspan="7" bgcolor="#D8D8D8"><p class="s10" style="padding-top: 3pt;padding-left: 3pt;text-indent: 0pt;line-height: 8pt;text-align: left;">Check to make sure NCP booted properly into bootloader...</p></td></tr><tr style="height:68pt"><td style="width:21pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">TX:</p><p class="s11" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">RX:</p><p class="s11" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">TX:</p><p class="s11" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">RX:</p><p class="s11" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">TX:</p><p class="s11" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">RX:</p><p class="s11" style="padding-left: 3pt;text-indent: 0pt;line-height: 8pt;text-align: left;">TX:</p></td><td style="width:19pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">[0B</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">[00</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">[0B</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">[C1</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">[0A</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">[82</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">[FD</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 107%;text-align: left;">A7] 09 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">A7] 01</p></td><td style="width:86pt" colspan="2" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s11" style="text-indent: 0pt;text-align: left;">A7]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s11" style="text-indent: 0pt;line-height: 8pt;text-align: left;">51 A7] RX: [FD 01</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s11" style="padding-top: 6pt;padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1A</p></td><td style="width:297pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s11" style="padding-top: 6pt;padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A7]</p></td></tr><tr style="height:10pt"><td style="width:21pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">TX:</p></td><td style="width:19pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">[FD</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;line-height: 8pt;text-align: center;">01</p></td><td style="width:86pt" colspan="2" bgcolor="#D8D8D8"><p class="s11" style="text-indent: 0pt;line-height: 8pt;text-align: left;">51 A7]</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:297pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:10pt"><td style="width:21pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">RX:</p></td><td style="width:19pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">[FD</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1A</p></td><td style="width:86pt" colspan="2" bgcolor="#D8D8D8"><p class="s11" style="text-indent: 0pt;line-height: 8pt;text-align: left;">52 01 FF FF 64 65</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">76</p></td><td style="width:297pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">30 34 37 31 00 FF FF FF FF FF FF FF FF 00 02 02 02 20 0A A7]</p></td></tr><tr style="height:10pt"><td style="width:21pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">TX:</p></td><td style="width:19pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">[FD</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;line-height: 8pt;text-align: center;">01</p></td><td style="width:86pt" colspan="2" bgcolor="#D8D8D8"><p class="s11" style="text-indent: 0pt;line-height: 8pt;text-align: left;">51 A7] RX: [FD 01</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1A</p></td><td style="width:297pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A7]</p></td></tr><tr style="height:30pt"><td style="width:143pt" colspan="5" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">TX: [FD 01 51 A7]</p><p class="s11" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">RX: [FD 1A 52 01 FF FF 64 65</p><p class="s11" style="padding-left: 3pt;text-indent: 0pt;line-height: 9pt;text-align: left;">Starting SPI bootloading...</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">76</p></td><td style="width:297pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">30 34 37 31 00 FF FF FF FF FF FF FF FF 00 02 02 02 20 0A A7]</p></td></tr><tr style="height:10pt"><td style="width:40pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 3pt;text-indent: 0pt;line-height: 8pt;text-align: left;">TX: [FD</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;line-height: 8pt;text-align: center;">01</p></td><td style="width:13pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: center;">51</p></td><td style="width:58pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A7]</p></td><td style="width:15pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:14pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:297pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:10pt"><td style="width:40pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 3pt;text-indent: 0pt;line-height: 8pt;text-align: left;">RX: [FD</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;line-height: 8pt;text-align: center;">01</p></td><td style="width:13pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1A</p></td><td style="width:58pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A7] TX: [FD</p></td><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">01</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">51</p></td><td style="width:297pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A7]</p></td></tr><tr style="height:10pt"><td style="width:40pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 3pt;text-indent: 0pt;line-height: 8pt;text-align: left;">RX: [FD</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1A</p></td><td style="width:13pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: center;">52</p></td><td style="width:58pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">01 FF FF 64</p></td><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">65</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">76</p></td><td style="width:297pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">30 34 37 31 00 FF FF FF FF FF FF FF FF 00 02 02 02 20 0A A7]</p></td></tr><tr style="height:10pt"><td style="width:40pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 3pt;text-indent: 0pt;line-height: 9pt;text-align: left;">TX: [FD</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;line-height: 9pt;text-align: center;">85</p></td><td style="width:13pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 9pt;text-align: center;">01</p></td><td style="width:58pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">01 FE 00 00</p></td><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">3C</p></td><td style="width:297pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">14 20 E2 60 48 7E AA 56 42 50 7C 53 0A</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="728" height="682" alt="image" src="an1084-gecko-bootloader-emberznet-silicon-labs-thread/Image_006.png"/></span></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:10pt"><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">71</p></td><td style="width:336pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">77 77 FF FF FF FF FF FF 78 61 70 32 62 2D 65 6D 32 36 30 2D 65 6D 32</p></td></tr><tr style="height:10pt"><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">35</p></td><td style="width:336pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">30 2D 64 65 76 30 34 37 30 00 00 00 00 00 00 00 80 ED 3A AA FD 03 21</p></td></tr><tr style="height:10pt"><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">00</p></td><td style="width:336pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">02 E0 00 04 57 40 00 00 3B E0 00 00 05 00 A1 E0 14 40 CA B7 E0 32</p></td></tr><tr style="height:10pt"><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">05</p></td><td style="width:336pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">38 1E 05 92 6C 00 02 80 0B 54 A7]</p></td></tr><tr style="height:295pt"><td style="width:351pt" colspan="2" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">RX: [FD 01 19 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">TX: [FD 01 51 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">RX: [FD 03 06 01 00 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 107%;text-align: left;">TX: [FD 85 01 02 FD FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF C0 1B 48 00 00 2B 20 C8 0A F0 C0 1B 01 04 01 00 91 E0 01 00 89 E0 C0 DB C0 2B FA 00 40 19 01 38 FA 00 40 29 FA</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">00 41 89 03 E4 FA 00 41 29 46 00 7A DB A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">RX: [FD 01 19 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">TX: [FD 01 51 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">RX: [FD 03 06 02 00 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">TX: [FD 85 01 03 FC 18 99 75 F4 C4 27 C6 23 C8 02 CA 03 CC 2F 7A 00 3E</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">15 DC 27 46 00 1A 15 CE 27 00 14 D8 27 7A 00 3E 25 46 00 00 15 CE C7 D8</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">B7 56 F4 00 10 D6 27 02 C4 03 00 49 F0 02 B0 D6 17 80 00 00 C4 03 00 D3</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">F0 80 00 00 B0 D6 17 40 00 00 C4 02 00 68 F0 40 00 00 B0 D6 17 04 00 00</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">C4 77 F0 04 00 00 B0 D6 17 20 0C 20 0F 00 00 00 B0 D6 17 10 00 00 C4 02</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">00 96 F0 10 00 00 B0 D6 17 08 00 C4 1E A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">RX: [FD 01 19 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">TX: [FD 01 51 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">RX: [FD 03 06 03 00 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">TX: [FD 85 01 04 FB 00 C4 03 00 B6 F0 08 00 00 B0 D6 17 02 00 00 C4 01</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">00 92 F0 02 00 00 B0 D6 17 01 00 00 C4 01 00 C3 F0 01 00 00 B0 D6 17 40</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">C4 01 00 38 F0 40 B0 D6 17 20 C4 01 00 F0 F0 20 B0 D6 17 10 C4 02 00 F7</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">F0 10 B0 D6 17 04 C4 03 00 D0 F0 D6 27 CE D7 CE 27 D6 17 19 E0 CE 17 46</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">00 1A 25 CC 1F DC 17 7A 00 3E 25 CA 07 C8 06 C6 13 C4 17 01 58 FA 00 40</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">29 C0 1B 05 EC C0 00 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">RX: [FD 01 19 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">TX: [FD 01 51 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">RX: [FD 03 06 04 00 A7]</p><p class="s11" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">250 more data block transmissions follow; omitted here for brevity.</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s9" style="padding-top: 5pt;padding-left: 373pt;text-indent: 9pt;line-height: 107%;text-align: left;">FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 00 C0 C8 04 F0 00</p><p style="text-indent: 0pt;text-align: left;"><span><img width="728" height="902" alt="image" src="an1084-gecko-bootloader-emberznet-silicon-labs-thread/Image_007.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 5pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">The frames following immediately below illustrate how the sequence number wraparound condition is handled...</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">TX: [FD 85 01 FE 01 22 17 24 57 2C C5 EA 25 20 17 24 37 EA 11 FC 3C FF</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">00 B1 9C 04 3C 28 3C FE E3 FE 2B F4 27 F6 23 C4 3C 1E 00 6D 9C 34 27 3E</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">17 FE 27 3C 17 FC 27 FE 2D FE 15 20 34 30 13 FC 3C FF 00 11 9C 40 37 2C</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">C5 04 3C 36 27 34 13 2C 81 03 F0 30 13 34 23 79 00 5E 19 34 3B 80 00 00</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">16 04 54 2C C5 38 27 00 14 FE 27 04 14 FC 27 38 17 FA 27 FE 2D FE 15 10</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">34 34 13 FA 3C 58 9D 3A 17 3E 13 06 3C 20 00 83 32 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">RX: [FD 01 19 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">TX: [FD 01 51 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">RX: [FD 03 06 FE 00 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">TX: [FD 85 01 FF 00 C0 9C FE 00 C6 15 0F F4 FE 2D FE 15 20 34 FE 27 00</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">14 FC 27 FE 2D FE 15 10 34 04 10 FC 3C FE 00 6A 9C 04 3C FE 00 C6 15 0B</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">F4 FE 2D FE 15 20 34 FE 27 30 17 36 13 FE 3C FE 00 C4 9C 02 3C E2 2D E2</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">15 FE 27 FE 2D FE 15 20 34 FC 27 00 14 FA 27 F8 27 36 17 F6 27 32 17 F4</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">27 30 17 00 10 F4 3C FD 00 F9 9C 04 14 0A 27 FE 2D FE 11 0C 30 FE 2D FE</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">15 1C 34 0A 3C 44 9D 02 3C 00 84 03 F0 01 14 79 65 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">RX: [FD 01 19 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">TX: [FD 01 51 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">RX: [FD 03 06 FF 00 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">TX: [FD 85 01 00 FF 02 E0 00 14 3C 3C FE E3 FE 2B 10 14 42 00 18 25 42</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">00 44 15 01 B4 42 00 44 25 46 00 1A 15 08 B5 46 00 1A 25 6F 00 80 14 42</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">00 02 25 42 00 00 25 42 00 02 15 1F 34 42 00 02 25 01 14 42 00 18 25 7E</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">00 D8 25 6F 00 80 5 42 00 04 25 42 00 06 15 1F 34 18 25 00 14 7E 00 DA</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">25 01 14 F00 DC 25 FE E3 FE 2B FC 27 00 14 94 25 FA 00 9D 93 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">RX: [FD 01 19 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">TX: [FD 01 51 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">RX: [FD 03 06 00 00 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">TX: [FD 85 01 01 FE DC 25 41 00 2E 25 32 00 64 14 41 00 2C 25 15 14 42</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">00 48 25 60 00 664 41 00 40 25 58 14 41 00 42 25 03 14 41 00 44 25 00</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">26 25 28 14 41 00 38 25 55 14 41 00 34 25 ED 00 80 14 41 00 3A 25 09 14</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">41 00 3E 25 1F 14 41 00 30 25 0E 15 FA 27 0E 11 11 14 FA 3C 50 9D 7A 00</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">D8 15 02 3C 0C 00 4C 9C 40 14 42 00 44 25 03 14 42 00 42 25 41 00 4A 25 FA 00 0E DE A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">RX: [FD 01 19 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">TX: [FD 01 51 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">RX: [FD 03 06 01 00 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">TX: [FD 85 01 02 FD D6 15 0D 00 B0 9C 00 84 06 F4 01 00 2D 10 03 00 24</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">14 46 9D FA 00 D7 11 08 A0 08 A4 E2 21 E2 15 0D 00 47 9C 01 14 41 00 46</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">25 18 00 00 14F 00 B2 9C FF 10 FF 14 0F 00 A8 01 A2 E_00 7C 9C 01 14</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">0F 00 90 9C 01 14 41 00 14 25 46 00 1A 15 06 B5 46 00 1A 25 04 00 F3 14</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">46 00 1E 0 1C 25 FF 00 4D 9C 00 14 04 3C F 0F 42 _B A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">RX: [FD 01 19 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">TX: [FD 01 51 A7]</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">RX: [FD 03 06 02 00 A7]</p><p class="s12" style="padding-left: 24pt;text-indent: 0pt;line-height: 107%;text-align: left;">826 more data block transmissions follow; omitted here for brevity. The frames following immediately below illustrate how the last data block is padded to 128 bytes and how the transmission is concluded successfully with the EOT and a final query transaction...</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">TX: [FD 85 01 3F C0 01 00 01 00 FF FF FF 00 FF 00 FF 00 AB CD C1 10 FF</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;line-height: 107%;text-align: justify;">00 FC 04 00 04 5A 0C BA B8 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A</p><p class="s9" style="padding-left: 24pt;text-indent: 0pt;text-align: justify;">1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 1A 9F 61 A7]</p><table style="border-collapse:collapse;margin-left:20.083pt" cellspacing="0"><tr style="height:10pt"><td style="width:40pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">RX: [FD</p></td><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">01</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">19</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A7]</p></td><td style="width:32pt" rowspan="2" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:10pt"><td style="width:40pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">TX: [FD</p></td><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">01</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">51</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A7]</p></td></tr><tr style="height:10pt"><td style="width:40pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">RX: [FD</p></td><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">03</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">06</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">3F</p></td><td style="width:32pt" bgcolor="#D8D8D8"><p class="s11" style="text-indent: 0pt;line-height: 8pt;text-align: left;">00 A7]</p></td></tr><tr style="height:10pt"><td style="width:40pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">TX: [FD</p></td><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">01</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">04</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A7]</p></td><td style="width:32pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:10pt"><td style="width:40pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">RX: [FD</p></td><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">01</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">17</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A7]</p></td><td style="width:32pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:10pt"><td style="width:40pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">TX: [FD</p></td><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">01</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">51</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A7]</p></td><td style="width:32pt" bgcolor="#D8D8D8"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:10pt"><td style="width:40pt" bgcolor="#D8D8D8"><p class="s11" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: right;">RX: [FD</p></td><td style="width:15pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">03</p></td><td style="width:14pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">06</p></td><td style="width:17pt" bgcolor="#D8D8D8"><p class="s11" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">40</p></td><td style="width:32pt" bgcolor="#D8D8D8"><p class="s11" style="text-indent: 0pt;line-height: 8pt;text-align: left;">00 A7]</p></td></tr></table><p class="s12" style="padding-left: 23pt;text-indent: 0pt;line-height: 107%;text-align: left;">NCP resets back into EZSP at this point, so normal reset sequence occurs and frames begin to use 0xFE as SPI byte...</p><p class="s9" style="padding-left: 23pt;text-indent: 0pt;text-align: left;">TX: [0B A7]</p><p class="s9" style="padding-left: 23pt;text-indent: 0pt;text-align: left;">TX: [0B A7]</p><p class="s9" style="padding-left: 23pt;text-indent: 0pt;text-align: left;">TX: [0A A7]</p><p class="s9" style="padding-left: 23pt;text-indent: 0pt;text-align: left;">TX: [0B A7]</p><p class="s9" style="padding-left: 23pt;text-indent: 0pt;text-align: left;">TX: [0B A7]</p><p class="s9" style="padding-left: 23pt;text-indent: 0pt;text-align: left;">TX: [0A A7]</p><p class="s9" style="padding-left: 23pt;text-indent: 0pt;text-align: left;">TX: [FE 04 07 00 00 02 A7]</p><p class="s9" style="padding-left: 23pt;text-indent: 0pt;text-align: left;">RX: [FE 07 07 80 00 02 02 40 32 A7]</p><p class="s9" style="padding-left: 23pt;text-indent: 0pt;text-align: left;">TX: [FE 04 08 00 52 01 A7]</p></li><li><p class="s8" style="padding-top: 8pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark5">Errors and Status Codes</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">If an error occurs during the upload, the UART serial bootloader displays the message ‘Serial upload aborted,’ followed by a more de- tailed message and a hex error code. Some of the more common errors are shown in the following table. The UART serial bootloader then redisplays the bootloader menu. If an error occurs during the SPI serial bootload, the target produces an error response followed by an XModem Cancel frame and a reboot.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The following table describes the normal status codes, error conditions, and special characters or enumerations used by some or all of the Ember standalone bootloader variants as well as the Gecko Bootloader. For additional status codes specific to the Gecko Bootload- er see the Gecko Bootloader API documentation installed with your SDK in the platform/bootloader/documentation folder.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s8" style="padding-left: 125pt;text-indent: 0pt;text-align: center;">Table 2.1.  Serial Uploading Statuses, Error Messages, and Special Characters</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:24pt" cellspacing="0"><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#797777"><p class="s13" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Hex code</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#797777"><p class="s13" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Constant</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#797777"><p class="s13" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Description</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x00</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_SUCCESS</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Default success status.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x01</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">General error processing packet.</p></td></tr><tr style="height:30pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x1C</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BLOCK_TIMEOUT</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;padding-right: 18pt;text-indent: 0pt;text-align: left;">The bootloader timed out waiting for some part of the XModem frame.</p></td></tr><tr style="height:30pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x21</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BLOCKERR_SOH</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;padding-right: 6pt;text-indent: 0pt;text-align: left;">The bootloader did not find the expected start of header (SOH) character at the beginning of the XModem frame.</p></td></tr><tr style="height:40pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x22</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BLOCKERR_CHK</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;padding-right: 5pt;text-indent: 0pt;text-align: left;">The bootloader detected the sequence check byte of the XModem frame was not the inverse of the sequence byte.</p></td></tr><tr style="height:40pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x23</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BLOCKERR_CRCH</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;padding-right: 16pt;text-indent: 0pt;text-align: justify;">The bootloader encountered an error while comparing the high bytes of the received and calculated CRCx of the XModem frame.</p></td></tr><tr style="height:40pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x24</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BLOCKERR_CRCL</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: left;">The bootloader encountered an error while comparing the low bytes of the received and calculated CRCs of the XModem frame.</p></td></tr><tr style="height:30pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x25</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BLOCKERR_SEQUENCE</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;padding-right: 12pt;text-indent: 0pt;text-align: left;">The bootloader did not receive the expected sequence number in the current XModem frame.</p></td></tr><tr style="height:30pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x26</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BLOCKERR_PARTIAL</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;padding-right: 14pt;text-indent: 0pt;text-align: left;">The frame that the bootloader was trying to parse was deemed incomplete (some bytes missing or lost).</p></td></tr><tr style="height:30pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x27</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BLOCKERR_DUPLICATE</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;text-align: left;">The bootloader encountered a duplicate of the previous XModem frame.</p></td></tr><tr style="height:30pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x40</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_MASK</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;padding-right: 7pt;text-indent: 0pt;text-align: left;">Bitmask for any bootloader error codes returned in CAN or NAK frame.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x41</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_HEADER_EXP</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">No GBL header was received when expected.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x42</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_HEADER_WRITE_CRC</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Failed to write header or CRC.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x43</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_CRC</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">File or written image failed CRC check.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x44</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_UNKNOWN_TAG</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Unknown tag detected in GBL image.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x45</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_SIG</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Invalid GBL header contents.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x46</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_ODD_LEN</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Trying to flash odd number of bytes.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x47</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_BLOCK_INDEX</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Indexed past end of block buffer.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x48</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_OVWR_BL</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Attempt to overwrite bootloader flash.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x49</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_OVWR_SIMEE</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Attempt to overwrite SIMEE flash.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x4A</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_ERASE_FAIL</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Flash erase failed.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x4B</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_WRITE_FAIL</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Flash write failed.</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:24pt" cellspacing="0"><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#797777"><p class="s13" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Hex code</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#797777"><p class="s13" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Constant</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#797777"><p class="s13" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Description</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x4C</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_CRC_LEN</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">End tag CRC wrong length.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x4D</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_NO_QUERY</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Received data before query request/response.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x4E</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_BAD_LEN</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">An invalid length was detected in the upgrade image file.</p></td></tr><tr style="height:30pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x4F</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BL_ERR_TAGBUF</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;padding-right: 6pt;text-indent: 0pt;text-align: left;">Insufficient tag buffer size or an invalid length was found in the GBL image.</p></td></tr><tr style="height:19pt"><td style="width:540pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3"><p class="s15" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Special Characters Used in Packet Types</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x01</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">SOH</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Start of Header.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x03</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">CTRL_C</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Cancel (from sender).</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x04</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">EOT</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">End of Transmission.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x06</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">ACK</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Acknowledged.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x15</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">NAK</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Not acknowledged.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x18</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">CAN</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Cancel</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x43</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">C</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">ASCII ‘C’.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x51</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">QUERY</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">ASCII ‘Q’.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x52</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">QRESP</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">ASCII ‘R’.</p></td></tr><tr style="height:19pt"><td style="width:540pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="3"><p class="s15" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Status Codes Returned in a Synchronous Response</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x16</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">TIMEOUT</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Bootloader timed out expecting characters.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x17</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">FILEDONE</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">EOT process successfully.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x18</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">FILEABORT</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Transfer aborted prematurely.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x19</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">BLOCKOK</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Data block processed OK.</p></td></tr><tr style="height:19pt"><td style="width:140pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">0x1A</p></td><td style="width:166pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">QUERYFOUND</p></td><td style="width:234pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s14" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Successful query.</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s8" style="padding-top: 4pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark6">Running the Application Image</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">For standalone bootloader variants that utilize an interactive menu, bootloader menu option 2 (run) resets the target device into the uploaded application image. If no application image is present, or an error occurred during a previous upload, the bootloader returns to the menu. For SPI-based variants, which don’t use a menu, the application is run immediately upon ACKing the EOT frame from the source device.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s8" style="padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark7">Performing a Bootloader Upgrade</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Bootloader upgrade functionality is provided by the first stage bootloader on Series 1 devices, or the Secure Element on Series 2 devi- ces. On Series 2 devices, the Secure Element itself is also upgradable. On Series 1 devices, the first stage bootloader is not upgrada- ble. For more information on how to upgrade the secure element, see <i>UG266: Silicon Labs Gecko Bootloader User’s Guide</i>.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">To perform a bootloader upgrade with the standalone bootloaders, simply transmit two GBL files in succession. The first GBL file should contain a main bootloader upgrade image. After upload is completed, the device resets to upgrade the main bootloader. For standalone bootloader variants that utilize an interactive menu, bootloader menu option 2 (run) resets the target device into the first stage bootload- er to perform the upgrade, before returning to the upgraded main bootloader. The second GBL file, containing an application upgrade image, can then be uploaded.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">For SPI-based variants, which don’t use a menu, the upgraded bootloader is run immediately upon ACKing the EOT frame from the source device. Once the bootloader upgrade has been applied, the SPI Host loses connection to the device. An EmberZNet Host appli- cation will not be able to re-connect with the device with only a bootloader in place.</p></li><li><p class="s8" style="padding-top: 8pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark8">Upload Recovery</a></p></li></ol></li></ol><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">If an image upload fails, the target node is left without a valid application image. The standalone bootloader will re-enter firmware up- grade mode if it determines that the application image isn’t valid. However, the application image may have a valid structure, but contain a bug preventing normal operation. Regardless of the serial interface supported by your standalone bootloader, a GPIO-based trigger can be used to facilitate recovery via serial upload.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">You can configure your standalone bootloader to use a software-based GPIO pin check or other schemes of recovery mode activation such as button recovery by configuring the EZSP GPIO Activation plugin in the Application Builder framework, or by adding custom code to the bootloader project.</p><ol id="l9"><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark10">Using the Gecko Application Bootloader</a></h3><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l10"><li><p class="s8" style="padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark11">Acquiring a New Image</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The application bootloader relies on application code to obtain new code images. The bootloader itself only knows how to read a GBL image stored in the download space and copy the relevant portions to the main flash block. This approach means that the application developer is free to acquire the new code image in any way that makes sense (serial, OTA, and so on).</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Typically application developers choose to acquire the new code image over-the-air (OTA) since this is readily available on all devices. For OTA bootloading in zigbee networks, Silicon Labs recommends using the standard OTA Upgrade cluster defined in the Zigbee Cluster Library (ZCL). Code for this cluster is available in the Silicon Labs Zigbee application framework as several different plugins. <i>AN728: Zigbee Over-the-Air Bootload Cluster Server and Client Setup </i>walks through how this can be set up and run. For OTA boot- loading in non-zigbee networks where a ZCL-based application layer is not available, the application layer may define its own means of conveying firmware data over the networking protocol, or the application developer may define a proprietary means of accomplishing an OTA image transfer between a source device and a target.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">For customers who want to design their own application to acquire an image rather than using the the Silicon Labs Zigbee application framework&#39;s plugins, we provide some routines for interfacing with the download space. These routines allow you to get information about the storage device and interact with it. You can find the code and documentation for these routines in the source files <b>bootload- er-interface-app.c </b>and <b>bootloader-interface-app.h </b>in the platform/base/hal/micro/cortexm3/efm32 directory. If you do want to call these routines directly, it may be helpful to look at how the <b>OTA Cluster Platform Bootloader </b>plugin code works to ensure that these routines are used correctly. (See related files in the app/framework/plugin/ota-bootload directory of the EmberZNet PRO installation for more information.)</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s8" style="padding-top: 5pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark12">Performing an Application Upgrade</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The application and the bootloader have limited indirect contact. Their only interaction is through passing non-volatile data across mod- ule reboots.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Once the application decides to install a new image saved in the download space it calls the Ember HAL API <span class="s9">halAppBootloaderInstallNewImage()</span>. This call indicates to the bootloader that it should attempt to perform a firmware upgrade from storage slot 0, and reboots the device. This API is backwards-compatible with the legacy Ember bootloader. If performing a firmware upgrade from a different storage slot than slot 0 is desired, the Gecko Bootloader API should be used instead, by calling <span class="s9">bootloader_setBootloadList()</span>. If the bootloader fails to install the new image, it sets the reset cause to <span class="s9">RESET_BOOTLOADER_BADIMAGE </span>and resets the module. Upon startup, the application should read the reset cause with <span class="s9">halGetExtendedResetInfo()</span>. If the reset cause is set to <span class="s9">RESET_BOOTLOADER_BADIMAGE, </span>the application knows the install process failed and can attempt to obtain a new image. A printable error string can be acquired from calling <span class="s9">halGetExtendedResetString()</span>. Under normal circumstances, the application bootloader does not print anything on the serial line.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s8" style="padding-top: 6pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark13">Example Application Bootload</a></p><p style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">For details on how to set up and run an application bootload, see <i>AN728: Over-the-Air Bootload Server and Client Setup</i>.</p></li><li><p class="s8" style="padding-top: 8pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark14">External Storage Application Bootloader</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">See <i>UG266: Silicon Labs Gecko Bootloader User’s Guide </i>for information about memory configuration for external storage bootloaders. Note that, at the time of this writing, the OTA Simple Storage Module plugin code in the EmberZNet stack only supports storage config- urations with a single storage slot. The start address of the storage slot in the bootloader needs to be configured to the same value as the OTA Storage Start Offset of the OTA Simple Storage EEPROM Driver plugin in the Silicon Labs Zigbee application framework. The application developer is responsible for ensuring that this value is consistent across the stack and bootloader projects. Also keep in mind that the start address of the first storage slot in the bootloader should be offset from the beginning of the storage area by two times the page size of the underlying storage medium if more than one storage slot is configured.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Application bootloaders typically use a remote device to store the downloaded application image. This device can be accessed over either an I2C or SPI serial interface. Refer to <i>UG266: Silicon Labs Gecko Bootloader User’s Guide </i>for a list of supported Dataflash/ EEPROM devices. It is important to select a device whose size is at least the size of your flash in order to fit the application being bootloaded.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The default recommendation for external SPI serial flash is the MX25R, as this is available in standard and smaller packages, is sup- ported by standard drivers, and has very low software-enabled sleep current without the need for an external shutdown control circuit. Most radio boards from Silicon Labs are populated with the MX25R8035F for evaluation purposes. In general, customers should use parts that have low sleep current, don&#39;t require external shutdown control circuitry, and have software shutdown control. When using components with high idle/sleep current and no software shutdown control, an external shutdown control circuit is recommended to re- duce sleep current.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">For EFR32MG-based devices using the EFR32MG1, only the serial dataflash option is available; no local storage application bootload- er is presently offered. However, some EFR32MG ICs contain an integrated serial flash that can be utilized just like off-chip serial data- flash but without any additional components. EFR32MG-based devices using the EFR32MG12 and higher platforms support local stor- age application bootloaders.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Note that some of these chips have compatible pinouts with others, but there are several incompatible variations. Contact Silicon Labs for details on connecting I2C or other SPI dataflash chips to an EFR32.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Read-Modify-Write pertains to a feature of certain dataflash chips that their corresponding driver exposes, and that is exploited by the bootloader library. Chips without this feature require a page erase to be performed before writing to that page, which precludes random- access writes by an application. When using the Silicon Labs Zigbee application framework, the <b>OTA Simple Storage EEPROM Driver </b>plugin needs to be configured to take this into consideration.</p></li><li><p class="s8" style="padding-top: 8pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark15">Local Storage Application Bootloader</a></p></li></ol></li></ol><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The local storage bootloader is essentially an application bootloader with a data flash driver that uses a portion of the on-chip flash for image storage instead of an external storage chip. See <i>UG266: Gecko Bootloader User’s Guide </i>for information about memory configu- ration for internal storage. Note that the OTA Simple Storage Module plugin code in the EmberZNet stack only supports storage config- urations with a single storage slot at the time of this writing. The start address of the storage slot in the bootloader needs to be config- ured to the same value as the OTA Storage Start Offset of the OTA Simple Storage EEPROM plugin in the Silicon Labs Zigbee applica- tion framework. The application developer is responsible for ensuring that this value is consistent across the stack and bootloader projects. Also keep in mind that the start address of the first storage slot in the bootloader should be offset from the beginning of the storage area by two times the page size of the underlying storage medium if more than one storage slot is configured.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Since the local storage application bootloader changes the chip’s flash memory layout you must build your application with knowledge of this. To accomplish this, you must add the LOCAL_STORAGE_BTL global define to your IAR project file. If you’re creating your project file through AppBuilder in Simplicity Studio, then this will be done for you as long as you select Local Storage from the bootload- er dropdown.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 35pt;text-indent: 0pt;text-align: left;"><span><img width="682" height="251" alt="image" src="an1084-gecko-bootloader-emberznet-silicon-labs-thread/Image_008.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s8" style="padding-left: 270pt;text-indent: -238pt;text-align: left;">Figure 3.1. Main Flash Layout for Application Bootloader versus Local Storage Application Bootloader when Using Gecko Bootloader</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s8" style="padding-left: 23pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">On EFR32MG1 and EFR32xG21 (Series 2) devices, the application is offset by 16 kB to accommodate the bootloader at the bottom of main flash. On other Series 1 EFR32 devices, the Gecko Bootloader resides in the Bootloader flash region outside of main flash block.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h4 style="padding-left: 17pt;text-indent: 0pt;text-align: left;">Smart. Connected. Energy-Friendly.</h4><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s16" style="text-indent: 0pt;line-height: 9pt;text-align: center;">Products</p><p style="text-indent: 0pt;text-align: center;"><a href="http://www.silabs.com/products" class="s17">www.silabs.com/products</a></p><p class="s16" style="text-indent: 0pt;line-height: 9pt;text-align: center;">Quality</p><p style="text-indent: 0pt;text-align: center;"><a href="http://www.silabs.com/quality" class="s17">www.silabs.com/quality</a></p><p class="s16" style="text-indent: 0pt;line-height: 9pt;text-align: center;">Support and Community</p><p class="s18" style="text-indent: 0pt;text-align: center;">community.silabs.com</p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;"><span style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt;">		</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="767" height="695" alt="image" src="an1084-gecko-bootloader-emberznet-silicon-labs-thread/Image_009.png"/></span></p><p class="s19" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Disclaimer</p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">Silicon Labs intends to provide customers with the latest, accurate, and in-depth documentation of all peripherals and modules available for system and software implementers using or intending to use the Silicon Labs products. Characterization data, available modules and peripherals, memory sizes and memory addresses refer to each specific device, and &quot;Typical&quot; parameters provided can and do vary in different applications. Application examples described herein are for illustrative purposes only. Silicon Labs reserves the right to make changes without further notice to the product information, specifications, and descriptions herein, and does not give warranties as to the accuracy or completeness of the included information. Without prior notification, Silicon Labs may update product firmware during the manufacturing process for security or reliability reasons. Such changes will not alter the specifications or the performance of the product. Silicon Labs shall have no liability for the consequences of use of the information supplied in this document. This document does not imply or expressly grant any license to design or fabricate any integrated circuits. The products are not designed or authorized to be used within any FDA Class III devices, applications for which FDA premarket approval is required or Life Support Systems without the specific written consent of Silicon Labs. A &quot;Life Support System&quot; is any product or system intended to support or sustain life and/or health, which, if it fails, can be reasonably expected to result in significant personal injury or death. Silicon Labs products are not designed or authorized for military applications. Silicon Labs products shall under no circumstances be used in weapons of mass destruction including (but not limited to) nuclear, biological or chemical weapons, or missiles capable of delivering such weapons. Silicon Labs disclaims all express and implied warranties and shall not be responsible or liable for any injuries or damages related to use of a Silicon Labs product in such unauthorized applications.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">Trademark Information</p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">Silicon Laboratories Inc.® , Silicon Laboratories®, Silicon Labs®, SiLabs® and the Silicon Labs logo®, Bluegiga®, Bluegiga Logo®, ClockBuilder®, CMEMS®, DSPLL®, EFM®, EFM32®, EFR, Ember®, Energy Micro, Energy Micro logo and combinations thereof, &quot;the world’s most energy friendly microcontrollers&quot;, Ember®, EZLink®, EZRadio®, EZRadioPRO®, Gecko®, Gecko OS, Gecko OS Studio, ISOmodem®, Precision32®, ProSLIC®, Simplicity Studio®, SiPHY®, Telegesis, the Telegesis Logo®, USBXpress® , Zentri, the Zentri logo and Zentri DMS, Z-Wave®, and others are trademarks or registered trademarks of Silicon Labs. ARM, CORTEX, Cortex-M3 and THUMB are trademarks or registered trademarks of ARM Holdings. Keil is a registered trademark of ARM Limited. Wi-Fi is a registered trademark of the Wi-Fi Alliance. All other products or brand names mentioned herein are trademarks of their respective holders.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="152" height="75" alt="image" src="an1084-gecko-bootloader-emberznet-silicon-labs-thread/Image_010.png"/></span></p><p class="s19" style="padding-top: 6pt;padding-left: 168pt;text-indent: 0pt;text-align: left;">Silicon Laboratories Inc. 400 West Cesar Chavez Austin, TX 78701</p><p class="s19" style="padding-left: 168pt;text-indent: 0pt;text-align: left;">USA</p><p style="padding-top: 5pt;padding-left: 168pt;text-indent: 0pt;text-align: left;"><h2 href="http://www.silabs.com/">http://www.silabs.com</h2></p></body></html>
