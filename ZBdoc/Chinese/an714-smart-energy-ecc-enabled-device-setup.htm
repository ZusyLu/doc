<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>an714-smart-energy-ecc-enabled-device-setup</title><style type="text/css"> * {margin:0; padding:0; text-indent:0; }
 h1 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 24pt; }
 .s1 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6pt; }
 .s2 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s3 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s4 { color: #D81E2A; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 h3 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; }
 .p, p { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; margin:0pt; }
 .a, a { color: #049; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s5 { color: #049; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s6 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 .s7 { color: black; font-family:"Courier New", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s8 { color: black; font-family:"Courier New", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 h4 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .s10 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8pt; }
 .s11 { color: #FFF; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s12 { color: #FFF; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s13 { color: #231F20; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7pt; }
 .s14 { color: #231F20; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 h2 { color: #D91F2A; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 14pt; }
 li {display: block; }
 #l1 {padding-left: 0pt; }
 #l1> li>*:first-child:before {content: "• "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 li {display: block; }
 #l2 {padding-left: 0pt;counter-reset: d1 1; }
 #l2> li>*:first-child:before {counter-increment: d1; content: counter(d1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; }
 #l2> li:first-child>*:first-child:before {counter-increment: d1 0;  }
 #l3 {padding-left: 0pt; }
 #l3> li>*:first-child:before {content: "• "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l4 {padding-left: 0pt;counter-reset: d2 1; }
 #l4> li>*:first-child:before {counter-increment: d2; content: counter(d2, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l4> li:first-child>*:first-child:before {counter-increment: d2 0;  }
 #l5 {padding-left: 0pt;counter-reset: d3 1; }
 #l5> li>*:first-child:before {counter-increment: d3; content: counter(d3, lower-latin)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l5> li:first-child>*:first-child:before {counter-increment: d3 0;  }
 #l6 {padding-left: 0pt;counter-reset: d3 1; }
 #l6> li>*:first-child:before {counter-increment: d3; content: counter(d3, lower-latin)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l6> li:first-child>*:first-child:before {counter-increment: d3 0;  }
 li {display: block; }
 #l7 {padding-left: 0pt;counter-reset: f1 3; }
 #l7> li>*:first-child:before {counter-increment: f1; content: counter(f1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l7> li:first-child>*:first-child:before {counter-increment: f1 0;  }
 #l8 {padding-left: 0pt;counter-reset: f2 1; }
 #l8> li>*:first-child:before {counter-increment: f2; content: counter(f1, decimal)"."counter(f2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l8> li:first-child>*:first-child:before {counter-increment: f2 0;  }
 #l9 {padding-left: 0pt;counter-reset: f3 1; }
 #l9> li>*:first-child:before {counter-increment: f3; content: counter(f3, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l9> li:first-child>*:first-child:before {counter-increment: f3 0;  }
 #l10 {padding-left: 0pt;counter-reset: f3 1; }
 #l10> li>*:first-child:before {counter-increment: f3; content: counter(f3, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l10> li:first-child>*:first-child:before {counter-increment: f3 0;  }
 #l11 {padding-left: 0pt;counter-reset: f3 1; }
 #l11> li>*:first-child:before {counter-increment: f3; content: counter(f3, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l11> li:first-child>*:first-child:before {counter-increment: f3 0;  }
 li {display: block; }
 #l12 {padding-left: 0pt;counter-reset: g1 4; }
 #l12> li>*:first-child:before {counter-increment: g1; content: counter(g1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; }
 #l12> li:first-child>*:first-child:before {counter-increment: g1 0;  }
 #l13 {padding-left: 0pt;counter-reset: g2 1; }
 #l13> li>*:first-child:before {counter-increment: g2; content: counter(g2, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l13> li:first-child>*:first-child:before {counter-increment: g2 0;  }
 #l14 {padding-left: 0pt;counter-reset: g2 1; }
 #l14> li>*:first-child:before {counter-increment: g2; content: counter(g2, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l14> li:first-child>*:first-child:before {counter-increment: g2 0;  }
 li {display: block; }
 #l15 {padding-left: 0pt;counter-reset: h1 6; }
 #l15> li>*:first-child:before {counter-increment: h1; content: counter(h1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l15> li:first-child>*:first-child:before {counter-increment: h1 0;  }
 #l16 {padding-left: 0pt;counter-reset: h2 1; }
 #l16> li>*:first-child:before {counter-increment: h2; content: counter(h1, decimal)"."counter(h2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l16> li:first-child>*:first-child:before {counter-increment: h2 0;  }
 #l17 {padding-left: 0pt;counter-reset: h3 1; }
 #l17> li>*:first-child:before {counter-increment: h3; content: counter(h3, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l17> li:first-child>*:first-child:before {counter-increment: h3 0;  }
 #l18 {padding-left: 0pt; }
 #l18> li>*:first-child:before {content: "• "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l19 {padding-left: 0pt;counter-reset: h3 1; }
 #l19> li>*:first-child:before {counter-increment: h3; content: counter(h3, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l19> li:first-child>*:first-child:before {counter-increment: h3 0;  }
 #l20 {padding-left: 0pt; }
 #l20> li>*:first-child:before {content: "• "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l21 {padding-left: 0pt;counter-reset: h3 1; }
 #l21> li>*:first-child:before {counter-increment: h3; content: counter(h3, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l21> li:first-child>*:first-child:before {counter-increment: h3 0;  }
 #l22 {padding-left: 0pt;counter-reset: h3 1; }
 #l22> li>*:first-child:before {counter-increment: h3; content: counter(h3, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l22> li:first-child>*:first-child:before {counter-increment: h3 0;  }
 li {display: block; }
 #l23 {padding-left: 0pt;counter-reset: i1 7; }
 #l23> li>*:first-child:before {counter-increment: i1; content: counter(i1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; }
 #l23> li:first-child>*:first-child:before {counter-increment: i1 0;  }
 #l24 {padding-left: 0pt;counter-reset: i2 1; }
 #l24> li>*:first-child:before {counter-increment: i2; content: counter(i1, decimal)"."counter(i2, decimal)" "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l24> li:first-child>*:first-child:before {counter-increment: i2 0;  }
 #l25 {padding-left: 0pt;counter-reset: i3 1; }
 #l25> li>*:first-child:before {counter-increment: i3; content: counter(i3, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l25> li:first-child>*:first-child:before {counter-increment: i3 0;  }
 #l26 {padding-left: 0pt;counter-reset: i3 1; }
 #l26> li>*:first-child:before {counter-increment: i3; content: counter(i3, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l26> li:first-child>*:first-child:before {counter-increment: i3 0;  }
 #l27 {padding-left: 0pt;counter-reset: j1 1; }
 #l27> li>*:first-child:before {counter-increment: j1; content: counter(j1, decimal)". "; color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l27> li:first-child>*:first-child:before {counter-increment: j1 0;  }
</style></head><body><p style="padding-left: 24pt;text-indent: 0pt;text-align: left;"><span><img width="126" height="62" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_001.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="padding-top: 4pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">AN714: Smart Energy ECC-Enabled Device Setup Process</h1><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="713" height="1" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_002.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="163" height="1" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_003.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s1" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">KEY POINTS</p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="163" height="1" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_004.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l1"><li><p class="s2" style="padding-top: 4pt;padding-left: 17pt;text-indent: -7pt;text-align: left;">Test certificate generation</p></li><li><p class="s2" style="padding-top: 3pt;padding-left: 17pt;text-indent: -7pt;text-align: left;">Certificate file modification</p></li><li><p class="s2" style="padding-top: 3pt;padding-left: 17pt;text-indent: -7pt;text-align: left;">Installation code generation and programming</p></li><li><p class="s2" style="padding-top: 3pt;padding-left: 17pt;text-indent: -7pt;text-align: left;">Application setup (build time)</p></li><li><p class="s2" style="padding-top: 3pt;padding-left: 17pt;text-indent: -7pt;text-align: left;">Application setup (run time)</p></li><li><p class="s2" style="padding-top: 3pt;padding-left: 17pt;text-indent: -7pt;text-align: left;">Joining process for new device</p></li><li><p class="s2" style="padding-top: 3pt;padding-left: 17pt;text-indent: -7pt;text-align: left;">Network analyzer capture setup</p></li></ul><p style="text-indent: 0pt;text-align: left;"/><p class="s3" style="padding-left: 23pt;text-indent: 0pt;text-align: justify;">This document describes how to set up a device with the security resources required to support Smart Energy (SE) security, which is based on certificate-based key establishment (CBKE) using El- liptic-Curve Cryptography (ECC). This includes the ECC 163k1 curve used by Smart Energy 1.0 and 1.1, as well as the ECC 283k1 curve used by Smart Energy 1.2 and 1.4.</p><p class="s4" style="padding-bottom: 3pt;text-indent: 0pt;text-align: right;">Introduction</p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="713" height="0" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_005.png"/></span></p><ol id="l2"><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark0">Introduction</a></h3><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;">The processes described in this application note are all those required to set up Smart Energy (SE) elliptic curve cryptography (ECC)- enabled devices. The processes include the following:</p><ul id="l3"><li><p style="padding-top: 2pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">Test certificate generation</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">Certificate file manipulation</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">Certificate file programming</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">Installation code generation</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">Installation code programming</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">Application setup (build time)</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">Application setup (run time) if using unique link keys</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">Joining a new device</p></li><li><p style="padding-top: 3pt;padding-left: 36pt;text-indent: -9pt;text-align: left;">Simplicity Studio Network Analyzer capture setup</p></li></ul><p style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">While these security resources, which also include Certicom’s ECC library, available upon request from Silicon Labs’ support team, are not necessary for testing SE networks, any devices wishing to participate in or host a Zigbee-compliant, production-grade (non-test) SE network must implement these features.</p><p class="s5" style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;"><a href="http://www.zigbee.org/" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;" target="_blank">Readers of this document should be familiar with the Zigbee Smart Energy Application profile (available from the </a>http://www.zigbee.org <a href="https://www.silabs.com/support" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;" target="_blank">website in the Standards section) and have basic familiarity with the Silicon Labs’ graphical and command-line-based tools. A number of these processes use utilities available through Simplicity Studio’s development environment, such as Network Analyzer, AppBuilder, and Simplicity Commander. This document also assumes that the user already has access to the Certicom ECC library for their target platform, or an ECC-enabled network coprocessor image, for EZSP-based platforms. For access to this content, please contact the Silicon Labs support team through the Silicon Labs Support portal at </a>https://www.silabs.com/support<span style=" color: #000;">.</span></p><p class="s6" style="padding-top: 6pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">Because the ECC library is compiled with IAR, SE projects should also be compiled with IAR. Projects compiled with GCC may cause unexpected resets.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Smart Energy 1.0 utilized an ECC 163k1 curve with a 48-byte certificate format. All certified devices are required to support this. Smart Energy 1.2 introduces a new curve ECC 283k1, and a 74-byte certificate format. Smart Energy 1.2 devices <b>must </b>support the existing 163k1 ECC curve and may also support the new 283k1 curve, while Smart Energy 1.4 devices <b>must </b>also support the 283k1 curve. (The requirements for what devices must support the 238k1 ECC curve is spelled out in the Zigbee Smart Energy specification.)</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">The certificates and libraries are <b>not </b>interoperable. In order to support both curves, two sets of certificates, private keys, and CA public keys must be installed.</p><p class="s4" style="padding-bottom: 3pt;text-indent: 0pt;text-align: right;">Test Certification Generation</p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="713" height="0" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_006.png"/></span></p></li><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark1">Test Certification Generation</a></h3><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l4"><li><p class="s5" style="padding-left: 41pt;text-indent: -8pt;text-align: left;"><a href="http://www.certicom.com/index.php/gencertregister" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;" target="_blank">Register for an account (for test certificate generation) at </a>http://www.certicom.com/index.php/gencertregister<span style=" color: #000;">. This registration is valid for a limited time.</span></p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Log in to the test certificate generation site with your account login:</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;"><a href="http://www.certicom.com/index.php/devicelogin">http://www.certicom.com/index.php/devicelogin</a></p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Go to the certificate generation page:</p><p style="padding-top: 8pt;padding-left: 41pt;text-indent: 0pt;text-align: justify;"><a href="http://www.certicom.com/index.php/smartenergydevicecertificateservice" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;" target="_blank">ECC 163k1 curve-based Certificates: </a><a href="http://www.certicom.com/index.php/smartenergydevicecertificateservice" target="_blank">http://www.certicom.com/index.php/smartenergydevicecertificateservice</a></p><p style="padding-top: 8pt;padding-left: 41pt;text-indent: 0pt;text-align: justify;"><a href="http://www.certicom.com/index.php/smartenergydevicecertificateservice1dot2" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;" target="_blank">ECC 283k1 curve-based Certificates: </a><a href="http://www.certicom.com/index.php/smartenergydevicecertificateservice1dot2" target="_blank">http://www.certicom.com/index.php/smartenergydevicecertificateservice1dot2</a></p></li><li><p style="padding-top: 3pt;padding-left: 42pt;text-indent: -8pt;text-align: justify;">In the Subject ID field, enter the MAC address (EUI64) of the target device where the certificate will reside (MSB order, such as 000D6F... for Silicon Labs EUI64s). This can be different than your target node&#39;s current EUI64, but if the address differs, the cur- rent one will generally be overwritten during programming.</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;">ECC 163k1 curve-based Certificates:</p><ol id="l5"><li><p style="padding-top: 3pt;padding-left: 59pt;text-indent: -8pt;text-align: justify;">In the <b>Profile Attribute Data </b>field, enter any custom hex data you want associated with this device. (The recommended for- mat is profile ID [0109] + cert type [1 for test] + 16-bit Zigbee Manufacturer Code + optional customer data of any length.)</p></li><li><p style="padding-top: 2pt;padding-left: 59pt;text-indent: -8pt;text-align: justify;">Leave the <b>Public Key </b>field empty!</p></li></ol></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;">ECC 283k1 curve-based Certificates:</p><ol id="l6"><li><p style="padding-top: 3pt;padding-left: 59pt;text-indent: -8pt;text-align: left;">Leave the Lifetime field empty.</p></li><li><p style="padding-top: 3pt;padding-left: 59pt;text-indent: -8pt;text-align: left;">Check the <b>Key Agreement </b>checkbox.</p></li><li><p style="padding-top: 3pt;padding-left: 59pt;text-indent: -8pt;text-align: left;">Leave the Override Certificate Attributes field empty.</p></li><li><p style="padding-top: 3pt;padding-left: 59pt;text-indent: -8pt;text-align: left;">Leave the Public Key Contribution field empty.</p></li></ol></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Click <b>Generate</b>.</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Highlight and copy the text in the HTML table on the resulting page.</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -13pt;text-align: left;">Open a text editor and paste the contents of the table into the text file; save the file.</p></li></ol></li><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark2">Certificate File Modification</a></h3></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l7"><ol id="l8"><li><p class="s6" style="padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark3">Combined Certificate File</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">If you intend to install both certificates onto a device, you may combine the contents of the certificate files into a single file.</p><p class="s6" style="padding-top: 6pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">This portion of the process is subject to change if Certicom&#39;s certificate generation web page alters its output format. Silicon Labs is working with Certicom in the hope of achieving a more consistent output format in the future, one which would require less manual editing before programming.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li><p class="s6" style="padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark4">ECC 163k1 Curve</a></p><p style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">At the beginning of this process, the certificate text file you created in the previous step should look something like this (with different hex numbers in the fields):</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s7" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">CA Pub Key: 0200fde8a7f3d1084224962a4e7c54e69ac3f04da6b8</p><p class="s7" style="padding-left: 2pt;text-indent: 0pt;line-height: 107%;text-align: left;">Device Implicit Cert: 02040e92886475999701a626a75be9cfb9ccb0ee7481 000d6f000092e047544553545345434101091083d1bbd1bbd1bb</p><p class="s7" style="padding-left: 2pt;text-indent: 0pt;line-height: 107%;text-align: left;">Device Private Key: 00ea5606dec9ec8f85a5f53405b67b2988b74bcd73 Device Public Key: 0202f25c9e4aaf910d6bbc16f444715d39962e3a5500</p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;"/><ol id="l9"><li><p style="padding-top: 3pt;padding-left: 42pt;text-indent: -9pt;text-align: left;">Remove &quot;Device Public Key&quot; line from the certificate text file, as our tools do not use it.</p></li><li><p style="padding-top: 3pt;padding-left: 42pt;text-indent: -9pt;text-align: left;">Remove extra line breaks in the hex string following &quot;Device Implicit Cert:&quot; so that all characters are on one line.</p></li><li><p style="padding-top: 3pt;padding-left: 42pt;text-indent: -9pt;text-align: left;">Change &quot;CA Pub Key&quot; to &quot;CA Public Key&quot;</p></li><li><p style="padding-top: 3pt;padding-left: 42pt;text-indent: -9pt;text-align: left;">Make sure that only a single blank space is between the &quot;:&quot; and the hex string of each line (no tabs or extra white space).</p></li><li><p style="padding-top: 3pt;padding-left: 42pt;text-indent: -9pt;text-align: left;">Remove the extra blank space at the end of each line before the line return.</p><p style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">At the end of the process, the certificate text file should look like the following, with the Device Implicit Cert line on a single line:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s7" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;line-height: 107%;text-align: left;">CA Public Key: 0200fde8a7f3d1084224962a4e7c54e69ac3f04da6b8 Device Implicit Cert:</p><p class="s7" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">02040e92886475999701a626a75be9cfb9ccb0ee7481000d6f000092e047544553545345434101091083d1bbd1bbd1bb</p><p class="s7" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Device Private Key: 00ea5606dec9ec8f85a5f53405b67b2988b74bcd73</p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ol></li><li><p class="s6" style="padding-top: 4pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark5">ECC 283k1 Curve</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">At the beginning of this process the certificate text file you created in the previous step should look something like this (with different hex numbers in the fields):</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="728" height="85" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_007.png"/></span></p><p class="s7" style="text-indent: 0pt;line-height: 107%;text-align: left;">Device Implicit Cert: 00e4d6197cf4b7b87e0d081112131415161718005320b5f6ffffffff000000000000000900</p><p class="s7" style="text-indent: 0pt;text-align: left;">0200849946d913e09111970ff24bac05605fecaf258dfc1c586de5690de8b8d11b393a1b69</p><p class="s7" style="text-indent: 0pt;line-height: 107%;text-align: left;">Device Private Key: 01817e7b640c0833c3daa12cf57284e959551455246a0cbcf876955c4492a0416350255d Device Public Key: 02064af594acdee3c5cc41086c3f72f5b3ef6197cee9726e98d78227b4e0401cf08df0781d</p><p style="text-indent: 0pt;text-align: left;"/><p class="s7" style="text-indent: 0pt;text-align: left;">0207a445022d9f39f49bdc38380026a27a9e0a1799313ab28c5c1a1c6b605154db1dff6752</p><p style="text-indent: 0pt;text-align: left;"/><p class="s7" style="text-indent: 0pt;text-align: left;">CA Pub Key:</p><p style="text-indent: 0pt;text-align: left;"/><ol id="l10"><li><p style="padding-top: 5pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Remove &quot;Device Public Key&quot; line from the certificate text file, as our tools do not use it.</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Remove extra line breaks in the hex string following &quot;Device Implicit Cert:&quot; so that all characters are on one line.</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Change &quot;CA Pub Key&quot; to &quot;CA Public Key (283k1)&quot;</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Change “Device Implicit Cert” to “Device Implicit Cert (283k1)”</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Change “Device Private Key” to “Device Private Key (283k1)”</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Make sure that only a single blank space is between the &quot;:&quot; and the hex string of each line (no tabs or extra white space).</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Remove the extra blank space at the end of each line before the line return.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="704" height="72" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_008.png"/></span></p><p class="s7" style="padding-top: 5pt;padding-left: 41pt;text-indent: 0pt;line-height: 107%;text-align: left;">CA Public Key (283k1): 0207a445022d9f39f49bdc38380026a27a9e0a1799313ab28c5c1a1c6b605154db1dff6752 Device Implicit Cert (283k1):</p><p class="s7" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">00e4d6197cf4b7b87e0d081112131415161718005320b5f6ffffffff0000000000000009000200849946d913e09111970ff24bac05605fecaf2</p><p class="s7" style="padding-left: 41pt;text-indent: 0pt;line-height: 107%;text-align: left;">Device Private Key (283k1): 01817e7b640c0833c3daa12cf57284e959551455246a0cbcf876955c4492a0416350255d</p></li></ol></li><li><p class="s6" style="padding-top: 8pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark6">Certificate Programming</a></p><ol id="l11"><li><p style="padding-top: 8pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Ensure that Simplicity Commander (version 0.15 or higher) is installed.</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Change to the directory where the certificate text file is stored.</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Determine the serial number or IP address of the target node’s WSTK main board. This is visible from on the device’s LCD display or can be determined by using the following command and selecting the node of interest from the pop-up window:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 39pt;text-indent: 0pt;text-align: left;"><span class="s8" style=" background-color: #D8D8D8;"> commander adapter probe                                                                                      </span></p></li><li><p style="padding-top: 5pt;padding-left: 42pt;text-indent: -8pt;text-align: left;">Run either of the following command to apply the certificate (shown for Serial Number 440056147 and IP address 192.168.0.1 and certificate filename cert_001.txt):</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s7" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;line-height: 107%;text-align: left;">commander flash –-tokengroup znet –-tokenfile cert_001.txt -–serialno 440056147 commander flash –-tokengroup znet –-tokenfile cert_001.txt –-ip 192.168.0.1</p><p style="padding-left: 39pt;text-indent: 0pt;text-align: left;"/></li><li><p style="padding-top: 1pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Run either of the following commands to verify the certificate data:</p></li></ol></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s7" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;line-height: 107%;text-align: left;">commander tokendump –-tokengroup znet -–serialno 440056147 commander tokendump –-tokengroup znet –-ip 192.168.0.1</p><p style="padding-left: 39pt;text-indent: 0pt;text-align: left;"/><p class="s4" style="padding-bottom: 3pt;text-indent: 0pt;text-align: right;">Installation Code Generation</p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="713" height="0" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_009.png"/></span></p><ol id="l12"><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark7">Installation Code Generation</a></h3><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l13"><li><p style="padding-left: 42pt;text-indent: -8pt;text-align: left;">Pick a random hex string of 6, 8, 12, or 16 bytes. You can generate this programmatically with a random number generator if you wish.</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Open a text editor and enter this string (as ASCII) in a file by itself, preceded by the string &quot;Install Code: &quot;. Note the single white- space character following the colon.</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Save this file for later use.</p><p class="s4" style="padding-bottom: 3pt;text-indent: 0pt;text-align: right;">Installation Code Programming</p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="713" height="0" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_010.png"/></span></p></li></ol></li><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark8">Installation Code Programming</a><a name="bookmark9">&zwnj;</a></h3><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">Note: <span class="p">This is not necessary for devices that only form SE networks (like an Energy Services Interface (ESI), which is typically the Trust Center for the network) rather than join them.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l14"><li><p style="padding-top: 7pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Change to the directory where the certificate text file is stored.</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Determine the serial number or IP address of the target node’s WSTK main board. This is visible from on the device’s LCD display or can be determined by using the following command and selecting the node of interest from the pop-up window:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 39pt;text-indent: 0pt;text-align: left;"><span class="s8" style=" background-color: #D8D8D8;"> commander adapter probe                                                                                      </span></p></li><li><p style="padding-top: 5pt;padding-left: 42pt;text-indent: -8pt;text-align: left;">Run either of the following commands to apply the installation cod (shown for Serial Number 440056147 and IP address 192.168.0.1 and certificate filename cert_001.txt):</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s7" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;line-height: 107%;text-align: left;">commander flash –-tokengroup znet –-tokenfile inst_001.txt -–serialno 440056147 commander flash –-tokengroup znet –-tokenfile inst_001.txt –-ip 192.168.0.1</p><p style="padding-left: 39pt;text-indent: 0pt;text-align: left;"/></li><li><p style="padding-top: 1pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Run either of the following commands to verify the installation code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s7" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;line-height: 107%;text-align: left;">commander tokendump –-tokengroup znet -–serialno 440056147 commander tokendump –-tokengroup znet –-ip 192.168.0.1</p><p style="padding-left: 39pt;text-indent: 0pt;text-align: left;"/></li></ol></li><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark10">Application Setup (Build Time)</a></h3></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l15"><ol id="l16"><li><p class="s6" style="padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark11">Common</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">This section deals with instructions that are common to both System-on-SoC (SoC) and Host application configurations. Further details specific to each type of configuration are covered in the sections that follow. Note that a sample application for the Dual Band Coom- sHub is available on request from Silabs support. It will be delivered as a side package for the stack. However, the steps in this section assume that you have wish to modify one of the example applications.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">As a prerequisite to setting up an ECC-enabled device, first ensure that you have the ECC-enabled software content package for your EmberZNet PRO release. Access is granted by Silicon Labs Support upon request via the support portal, and the content packages can be found as ZIP files accompanying each EmberZNet PRO release in the Software Releases area of the Silicon Labs support portal. Once you’ve downloaded and extracted the content package, you are ready to follow the steps below.</p><p class="s6" style="padding-top: 6pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">Because the ECC library is compiled with IAR, SE projects should also be compiled with IAR. Projects compiled with GCC may cause unexpected resets.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l17"><li><p style="padding-left: 42pt;text-indent: -9pt;text-align: left;">Create a new project, as described in <i>QSG106: Zigbee EmberZNet PRO Quick-Start Guide</i>.</p></li><li><p style="padding-top: 3pt;padding-left: 42pt;text-indent: -9pt;text-align: left;">On the Zigbee Stack tab, set one of the following:</p><ul id="l18"><li><p style="padding-top: 3pt;padding-left: 54pt;text-indent: -9pt;text-align: left;">If you are using unique, per-device link keys based on installation codes for joining devices, as should be the case for produc- tion deployments, set the <b>Security </b>option to &quot;Smart Energy Security full (compliant)&quot;.</p></li><li><p style="padding-top: 2pt;padding-left: 54pt;text-indent: -9pt;text-align: left;">If you are using a single, global link key for all devices to join, as is often used in development/testing scenarios to reduce com- plexity, set the <b>Security </b>option to &quot;Smart Energy Security test&quot;.</p></li></ul></li><li><p style="padding-top: 2pt;padding-left: 42pt;text-indent: -8pt;text-align: left;">Follow the directions in one of the sub-sections below for building either a System-on-Chip application, a Custom Network Copro- cessor (NCP), or an EZSP Host application with ECC support.</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">After completing the steps as per the subsections below, set up the remaining device configuration as appropriate, and generate the project.</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">Populate callbacks in the generated project as necessary, then build and load to the target device (after the certificate and installa- tion codes have been programmed as described above).</p><p style="padding-top: 6pt;padding-left: 41pt;text-indent: 0pt;text-align: left;"><b>Note: </b>The certificate and installation code data only reside on the processor where the stack is being run, which is either the SoC processor itself in the SoC use case or the NCP, <i>not </i>the host processor, in the EZSP-enabled host/NCP use case.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ol></li><li><p class="s6" style="padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark12">System on Chip (SoC)</a><a name="bookmark15">&zwnj;</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">Use these steps to configure an SoC-based Smart Energy application with ECC support.</p><ol id="l19"><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: left;">On the Plugins tab, in the Stack Libraries section, confirm the following settings:</p><ul id="l20"><li><p style="padding-top: 3pt;padding-left: 54pt;text-indent: -9pt;text-align: left;">Enable the <b>CBKE 163k Library </b>plugin.</p></li><li><p style="padding-top: 3pt;padding-left: 54pt;text-indent: -9pt;text-align: left;">If you intend to use the 283k1 ECC Curve (Smart Energy 1.2 or higher), then enable the <b>Use CBKE 283k Library </b>plugin.</p></li><li><p style="padding-top: 3pt;padding-left: 54pt;text-indent: -9pt;text-align: left;">If supporting OTA upgrades with image signature verification, enable the <b>CBKE DSA Verify Library </b>and, if supporting the 283k1 ECC curve, also enable the <b>CBKE 283k1 DSA Verify Library</b>.</p></li><li><p style="padding-top: 2pt;padding-left: 54pt;text-indent: -9pt;text-align: left;">Enable the <b>CBKE Core Library </b>plugin.</p></li><li><p style="padding-top: 3pt;padding-left: 54pt;text-indent: -9pt;text-align: left;">Enable the <b>ECC 163k1 Library </b>plugin, and then, in the <b>Library path </b>text entry box for the plugin options, enter the file path to the location of your non-283k1 ECC library file, typically named something like ecc-library-{platformName}.a.</p></li><li><p style="padding-top: 2pt;padding-left: 54pt;text-indent: -9pt;text-align: left;">Enable the <b>ECC 283k1 Library </b>plugin, and then, in the <b>Library path </b>text entry box for the plugin options, enter the file path to the location of your 283k1 ECC library file, typically named something like ecc-library-283k1-{platformName}.a.</p></li><li><p style="padding-top: 2pt;padding-left: 54pt;text-indent: -9pt;text-align: left;">Enable the <b>Security Core Library </b>plugin.</p></li><li><p style="padding-top: 3pt;padding-left: 54pt;text-indent: -9pt;text-align: left;">Enable the <b>Security Link Keys Library </b>plugins and set the Link Key Table Size according to your needs in the options area for this plugin.</p></li></ul></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;">In the Plugins tab, in the Smart Energy section, enable the <b>Key Establishment </b>plugin, and then, in the Options area, select the appropriate choice in the <b>SE Version </b>list depending on whether your device should behave in an SE 1.2 fashion (in which both 162k1 and 283k1 ECC curves are required for CBKE) or a pre-1.2 SE 1.x fashion (in which only 163k1 ECC support is used for CBKE).</p><p class="s6" style="padding-top: 6pt;padding-left: 41pt;text-indent: 0pt;text-align: left;">Note: <span class="p">Some older versions of AppBuilder do not support white space in the ECC library path, so you may need to relocate these files to satisfy this requirement.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">Then enable the <b>Smart Energy registration </b>plugin. This will take care of the CBKE (certificate-based keyestablishment) process that will determine the link key.</p></li></ol></li><li><p class="s6" style="padding-top: 8pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark13">Custom Network Coprocessor</a></p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">Use these steps to configure a custom EmberZNet PRO network coprocessor (NCP) via the Customizable Network Coprocessor Appli- cations framework. Refer to AN1010, <i>Building a Customized NCP Application</i><a href="#bookmark16" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;">, for more information about custom NCP design using this framework. Note that this is not the same as configuring a host application (which talks to an NCP via EZSP) for a Smart Energy device. That process is covered in the next section, </a><span style=" color: #049;">6.4 EZSP Host</span>.</p><p style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">There are different versions of the network coprocessor with and without ECC support compiled in. Access to the ECC version is gran- ted by Silicon Labs Support upon request. The ECC version of the network coprocessor firmware contains support for both ECC 163k1 and ECC 283k1 curves. However, the curves can be utilized depend on the certificates that are installed on the coprocessor.</p><p style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">When configuring a custom NCP to support ECC-enabled Smart Energy operation, do the following in AppBuilder, Plugins tab:</p><ol id="l21"><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;"><a href="#bookmark15" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;">In the Stack Libraries section, enable the same library plugins and similar options as described in the section </a><a href="#bookmark15" class="a">6.2 System on Chip </a><span style=" color: #049;">(SoC)</span>. However, for libraries that are not being enabled, you must enable the corresponding “Stub Library” plugin, such as the <b>CBKE 283k1 DSA Verify Stub Library </b>plugin as a substitute for the <b>CBKE 283k1 DSA Verify Library </b>plugin.</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;">In the Command Handler section, enable the <b>CBKE Library EZSP Command Handlers </b>plugin.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ol></li><li><p class="s6" style="padding-top: 5pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark14">EZSP Host</a><a name="bookmark16">&zwnj;</a></p><p style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">Use these steps to configure an ECC-enabled host application, which is designed to talk to an ECC-enabled EmberZNet PRO NCP via EZSP. In AppBuilder, on the Plugins tab:</p><ol id="l22"><li><p style="padding-top: 2pt;padding-left: 42pt;text-indent: -8pt;text-align: justify;">In the Smart Energy section, enable the <b>Key Establishment </b>plugin, and then, in the options area, select the appropriate choice in the <b>SE Version </b>list depending on whether your device should behave in an SE 1.2 or later fashion (in which both 162k1 and 283k1 ECC curves are required for CBKE) or a pre-1.2 SE 1.x fashion (in which only 163k1 ECC support is used for CBKE).</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;">In the Utility section, enable the <b>NCP Configuration </b>plugin, and then, in the options area, set the Link Key Table Size according to your needs.</p></li></ol></li></ol></ol><p class="s6" style="padding-top: 6pt;padding-left: 41pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">This table size setting cannot exceed the maximum link key table size configured within your NCP firmware. If it does, an error will be detected and reported in the standard output stream of the host application during NCP initialization. If necessary, you can adjust the link key table size of the NCP using the Custom Network Processor method described in the previous section.</span></p><p class="s4" style="padding-bottom: 3pt;padding-left: 247pt;text-indent: 0pt;text-align: left;">Application Setup (Run Time) Prior to Joining a New Device to the HAN</p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="713" height="0" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_011.png"/></span></p><ol id="l23"><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark17">Application Setup (Run Time) Prior to Joining a New Device to the HAN</a><a name="bookmark20">&zwnj;</a></h3><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 23pt;text-indent: 0pt;text-align: justify;">Note: <span class="p">This process is only required if you are using installation codes to generate unique, per-device link keys, such as when &quot;Smart Energy Security (full)&quot; is selected as the security model for your application configuration in AppBuilder.) If you are using a global link key for joining, such as when using AppBuilder’s “Smart Energy Security (test)” security model, skip this section.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">This section describes the process of setting up the Trust Center device (the network coordinator) for the SE network to accept an in- coming SE device into its home area network (HAN). It also describes the process of setting up a new HAN device prior to joining the HAN created by this Trust Center.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l24"><li><p class="s6" style="padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark18">Procedure for Development Prototypes / Debugging</a></p><p class="s5" style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark21" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;">This process relies on the serial command line interface (CLI) to the Zigbee application framework. If the CLI is no longer supported or accessible on your network’s Trust Center or incoming HAN device, please refer to section </a><a href="#bookmark21" class="a">7.2 Procedure for Production/Field Deploy- </a>ments<span style=" color: #000;">.</span></p><ol id="l25"><li><p class="s5" style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;"><a href="#bookmark9" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;">Before joining a HAN device to the SE network, determine its installation code string, including its 16-bit CRC (in LSB order), as well as its EUI64 (MAC address). In a development/debugging environment, you can do this using the Simplicity Commander tool with the appropriate &quot;tokendump&quot; option to output the installation code data. See the section </a><a href="#bookmark9" class="a">5. Installation Code Programming</a> <span style=" color: #000;">for more information.</span></p></li><li><p style="padding-top: 2pt;padding-left: 42pt;text-indent: -8pt;text-align: justify;">Use the “option install-code …” CLI command at the Trust Center device during the development/debugging phase. The applica- tion framework then verifies the CRC for the provided installation code, computes the device-specific link key from this code, and then adds the hashed key result to the specified key table index on the Trust Center for the specified EUI64.</p></li><li><p style="padding-top: 2pt;padding-left: 42pt;text-indent: -8pt;text-align: justify;">Confirm that the proper key table entry now exists and is displayed in the output of the &quot;keys print&quot; command at the trust center.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ol></li><li><p class="s6" style="padding-top: 5pt;padding-left: 41pt;text-indent: -17pt;text-align: left;"><a name="bookmark19">Procedure for Production/Field Deployments</a><a name="bookmark21">&zwnj;</a></p><ol id="l26"><li><p style="padding-top: 8pt;padding-left: 42pt;text-indent: -8pt;text-align: justify;">Before joining a HAN device to the SE network, determine its installation code string, including its 16-bit CRC (in LSB order), as well as its EUI64 (MAC address); these byte values are meant to be published externally with the device for use during installation.</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;">Using some out-of-band (non-Zigbee) method, such as verbally or through some proprietary communications interface, convey the HAN device&#39;s installation code to the ESI for the HAN, its trust center device (if different from the ESI), or some head-end device in the utility&#39;s backhaul network that has access to the HAN&#39;s ESI.</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;">Have the ESI (or the utility’s head-end) sanity-check the provided installation code by computing the CRC of those hex bytes (less the final two, which are the provided CRC16 from the installer) using the CRC16 algorithm described in the &quot;CRC Algorithm Infor- mation&quot; section (section 5.4.8.1.1.1 in the current [r15] version) of the Zigbee Smart Energy Application Profile Specification (Zig- bee document 075356). The computed CRC (when converted into LSB order) for the 6/8/12/16-digit code should match the last 4 digits of the provided installation code string.</p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;">Once the installation code string (variable-length code + 2-byte CRC16 in LSB order) has been verified, have the ESI or its head- end compute the device-specific initial link key by performing an AES MMO hash function against the entire 8/10/14/18-byte string, using the algorithm described in the &quot;MMO Hash Code Example&quot; section (section 5.4.8.1.2.1 in the current [r15] version) of the ZigBee Smart Energy Application Profile Specification (ZigBee document 075356).</p><p class="s4" style="padding-bottom: 3pt;text-indent: 0pt;text-align: right;">Joining Process for New Device</p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="713" height="0" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_012.png"/></span></p></li></ol></li></ol></li><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark22">Joining Process for New Device</a></h3><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 24pt;text-indent: 0pt;text-align: left;"><a href="#bookmark20" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;">If you are using installation codes to create unique keys, the application setup process discussed in the previous section </a><a href="#bookmark20" class="a">7. Application </a>Setup (Run Time) Prior to Joining a New Device to the HAN <span style=" color: #000;">should have been performed.</span></p><ol id="l27"><li><p style="padding-top: 2pt;padding-left: 42pt;text-indent: -9pt;text-align: left;">Join the new HAN device to the ESI&#39;s HAN (using the Button Form/Join Plugin or &quot;network join ...&quot; CLI command or</p><p class="s7" style="padding-left: 42pt;text-indent: 0pt;text-align: left;">emberAfStartSearchForJoinableNetwork <span class="p">API function, for example).</span></p></li><li><p style="padding-top: 2pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;">The ESI (as Trust Center) will trigger its <span class="s7">emberAfTrustCenterJoinCallback() </span>to indicate the outcome of the initial joining proc- ess. If successful, the joining device should begin CBKE.</p></li><li><p style="padding-top: 3pt;padding-left: 41pt;text-indent: -8pt;text-align: justify;">If both the ESI and HAN devices support CBKE and ECC and have valid certificates issued by the same authority, CBKE should succeed, and the HAN device should move on to registration (asking the ESI to bind to it on specific clusters). When the SE regis- tration process completes, the HAN device will trigger its <span class="s7">emberAfRegistrationCallback() </span>to notify the application.</p></li><li><p style="padding-top: 2pt;padding-left: 42pt;text-indent: -8pt;text-align: justify;">After the SE registration completes successfully, the HAN device can now send/receive messages to/from the ESI using its CBKE- authorized link key.</p></li></ol><p style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">Note that steps 2 through 4 are automatically handled by the <b>Smart Energry Registration </b>plugin.</p><p class="s4" style="padding-bottom: 3pt;text-indent: 0pt;text-align: right;">Network Analyzer Capture Setup</p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="713" height="0" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_013.png"/></span></p></li><li><h3 style="padding-top: 7pt;padding-left: 39pt;text-indent: -15pt;text-align: left;"><a name="bookmark23">Network Analyzer Capture Setup</a></h3></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 23pt;text-indent: 0pt;text-align: justify;"><a href="#bookmark20" style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;">To capture the initial joining process before CBKE, first determine the device&#39;s preconfigured link key (either the unique one generated from the installation code as described in the section </a>7. Application Setup (Run Time) Prior to Joining a New Device to the HAN <span style=" color: #000;">or the global one if using SE Security Test mode). Enter this code into Network Analyzer using either of the two methods described below before attempting to join the HAN.</span></p><p style="padding-top: 8pt;padding-left: 24pt;text-indent: 0pt;text-align: justify;">To capture the encrypted SE traffic after CBKE/registration has been performed, determine the CBKE-authorized link key by querying either the HAN device or the ESI. If the serial CLI is still available, you can use the &quot;keys print&quot; command. If you are using the stack API directly, use the <span class="s7">emberGetKey() </span>API. Enter the discovered key into Network Analyzer (see the two methods below) after CBKE com- pletes; remember that this key is unique for each instance of CBKE, even for the same pair of devices.</p><p style="padding-top: 8pt;padding-left: 23pt;text-indent: 0pt;text-align: justify;">You can enter the key into Network Analyzer through the main list of keys at Window &gt; Preferences &gt; Network Analyzer &gt; Decoding &gt; Security Keys. Keys must be entered here before beginning a capture session, else they will not be used for decryption.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h4 style="padding-left: 17pt;text-indent: 0pt;text-align: left;">Smart. Connected. Energy-Friendly.</h4><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="text-indent: 0pt;line-height: 9pt;text-align: center;">Products</p><p style="text-indent: 0pt;text-align: center;"><a href="http://www.silabs.com/products" class="s11">www.silabs.com/products</a></p><p class="s10" style="text-indent: 0pt;line-height: 9pt;text-align: center;">Quality</p><p style="text-indent: 0pt;text-align: center;"><a href="http://www.silabs.com/quality" class="s11">www.silabs.com/quality</a></p><p class="s10" style="text-indent: 0pt;line-height: 9pt;text-align: center;">Support and Community</p><p class="s12" style="text-indent: 0pt;text-align: center;">community.silabs.com</p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;"><span style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt;">		</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="767" height="695" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_014.png"/></span></p><p class="s13" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Disclaimer</p><p class="s14" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">Silicon Labs intends to provide customers with the latest, accurate, and in-depth documentation of all peripherals and modules available for system and software implementers using or intending to use the Silicon Labs products. Characterization data, available modules and peripherals, memory sizes and memory addresses refer to each specific device, and &quot;Typical&quot; parameters provided can and do vary in different applications. Application examples described herein are for illustrative purposes only. Silicon Labs reserves the right to make changes without further notice to the product information, specifications, and descriptions herein, and does not give warranties as to the accuracy or completeness of the included information. Without prior notification, Silicon Labs may update product firmware during the manufacturing process for security or reliability reasons. Such changes will not alter the specifications or the performance of the product. Silicon Labs shall have no liability for the consequences of use of the information supplied in this document. This document does not imply or expressly grant any license to design or fabricate any integrated circuits. The products are not designed or authorized to be used within any FDA Class III devices, applications for which FDA premarket approval is required, or Life Support Systems without the specific written consent of Silicon Labs. A &quot;Life Support System&quot; is any product or system intended to support or sustain life and/or health, which, if it fails, can be reasonably expected to result in significant personal injury or death. Silicon Labs products are not designed or authorized for military applications. Silicon Labs products shall under no circumstances be used in weapons of mass destruction including (but not limited to) nuclear, biological or chemical weapons, or missiles capable of delivering such weapons. Silicon Labs disclaims all express and implied warranties and shall not be responsible or liable for any injuries or damages related to use of a Silicon Labs product in such unauthorized applications.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s13" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">Trademark Information</p><p class="s14" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">Silicon Laboratories Inc.®, Silicon Laboratories®, Silicon Labs®, SiLabs® and the Silicon Labs logo®, Bluegiga®, Bluegiga Logo®, ClockBuilder®, CMEMS®, DSPLL®, EFM®, EFM32®, EFR, Ember®, Energy Micro, Energy Micro logo and combinations thereof, &quot;the world’s most energy friendly microcontrollers&quot;, Ember®, EZLink®, EZRadio®, EZRadioPRO®, Gecko®, Gecko OS, Gecko OS Studio, ISOmodem®, Precision32®, ProSLIC®, Simplicity Studio®, SiPHY®, Telegesis, the Telegesis Logo®, USBXpress® , Zentri, the Zentri logo and Zentri DMS, Z- Wave®, and others are trademarks or registered trademarks of Silicon Labs. ARM, CORTEX, Cortex-M3 and THUMB are trademarks or registered trademarks of ARM Holdings. Keil is a registered trademark of ARM Limited. Wi-Fi is a registered trademark of the Wi-Fi Alliance. All other products or brand names mentioned herein are trademarks of their respective holders.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="152" height="75" alt="image" src="an714-smart-energy-ecc-enabled-device-setup/Image_015.png"/></span></p><p class="s13" style="padding-left: 168pt;text-indent: 0pt;text-align: left;">Silicon Laboratories Inc. 400 West Cesar Chavez Austin, TX 78701</p><p class="s13" style="padding-left: 168pt;text-indent: 0pt;text-align: left;">USA</p><p style="padding-top: 5pt;padding-left: 168pt;text-indent: 0pt;text-align: left;"><h2 href="http://www.silabs.com/">http://www.silabs.com</h2></p></body></html>
